<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Admin â€” AvaUTS v2.0.0</title>
  <link rel="stylesheet" href="./css/base.css" />
  <link rel="stylesheet" href="./css/metrics.css" />
  <link rel="stylesheet" href="./css/feedback.css" />
  <link rel="stylesheet" href="./css/knowledge.css" />
  <link rel="stylesheet" href="./css/maintenance.css" />
</head>
<body>
  <header class="header">
    <h1>
      <img src="/assets/animations/ChatbotVerdeUTS.gif" alt="AvaUTS">
      AvaUTS â€” Panel de AdministraciÃ³n v2.0
    </h1>
    <div class="header-controls">
      <button id="themeToggle" title="Tema">ğŸŒ“</button>
      <span class="badge">UTS</span>
    </div>
  </header>

  <nav class="nav-tabs">
    <button class="tab-btn active" data-tab="metrics">ğŸ“Š MÃ©tricas</button>
    <button class="tab-btn" data-tab="feedback">ğŸ’¬ Feedback</button>
    <button class="tab-btn" data-tab="knowledge">ğŸ“š Base de Conocimiento</button>
    <button class="tab-btn" data-tab="maintenance">âš™ï¸ Mantenimiento</button>
  </nav>

  <main class="container">
    <!-- SECCIÃ“N 1: MÃ‰TRICAS (solo lectura) -->
    <section id="metrics-section" class="tab-content active">
      <div class="section-header">
        <h2>ğŸ“Š MÃ©tricas del Sistema</h2>
        <button id="refreshMetrics" class="btn btn-outline">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 3V9M3 9H9M3 9L6.5 5.5C8.28 3.72 10.86 2.5 13.5 2.5C18.19 2.5 22 6.31 22 11C22 15.69 18.19 19.5 13.5 19.5C10.25 19.5 7.5 17.86 6.06 15.31" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Actualizar
        </button>
      </div>
      
      <div class="metrics-cards">
        <div class="metric-card">
          <div class="metric-icon">ğŸ’¬</div>
          <div class="metric-content">
            <div class="metric-title">Conversaciones Totales</div>
            <div id="totalConversations" class="metric-value">â€”</div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">ğŸ˜Š</div>
          <div class="metric-content">
            <div class="metric-title">SatisfacciÃ³n</div>
            <div id="satisfactionRate" class="metric-value">â€”%</div>
            <div class="progress-bar">
              <div id="satisfactionBar" class="progress-fill" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">ğŸ“</div>
          <div class="metric-content">
            <div class="metric-title">Feedback Recibido</div>
            <div id="feedbackTotal" class="metric-value">â€”</div>
            <div id="feedbackPos" class="metric-subtitle">â€” positivos</div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">âš™ï¸</div>
          <div class="metric-content">
            <div class="metric-title">Estado del Sistema</div>
            <div id="statusMetrics" class="metric-value status-indicator">Verificando...</div>
          </div>
        </div>
      </div>

      <div class="recent-conversations">
        <div class="section-header">
          <h3>ğŸ’¬ Conversaciones Recientes</h3>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Pregunta</th>
                <th>Respuesta</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody id="lastConversations">
              <tr><td colspan="5" class="loading">Cargando...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SECCIÃ“N 2: FEEDBACK -->
    <section id="feedback-section" class="tab-content">
      <div class="section-header">
        <h2>ğŸ’¬ GestiÃ³n de Feedback</h2>
        <p class="section-description">
          Revisa los comentarios y calificaciones de los usuarios para mejorar el servicio del chatbot.
        </p>
      </div>

      <!-- ESTADÃSTICAS DE FEEDBACK -->
      <div class="kb-stats">
        <div class="kb-stat">
          <div class="kb-stat-value" id="feedbackStatsTotal">0</div>
          <div class="kb-stat-label">ğŸ“Š Total Votos</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="feedbackStatsPositive">0</div>
          <div class="kb-stat-label">ğŸ‘ Respuestas Ãštiles</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="feedbackStatsNegative">0</div>
          <div class="kb-stat-label">ğŸ‘ Respuestas No Ãštiles</div>
        </div>
      </div>

      <!-- FILTROS DE FEEDBACK -->
      <div class="action-card">
        <div class="action-header">
          <h3>ğŸ” Filtros</h3>
        </div>
        <div class="filters-row">
          <div class="filter-group">
            <label for="feedbackType">Tipo:</label>
            <select id="feedbackType" class="filter-select">
              <option value="all">Todos los votos</option>
              <option value="positive">Solo Ãºtiles</option>
              <option value="negative">Solo no Ãºtiles</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="feedbackPeriod">PerÃ­odo:</label>
            <select id="feedbackPeriod" class="filter-select">
              <option value="all">Todo el tiempo</option>
              <option value="today">Hoy</option>
              <option value="week">Ãšltima semana</option>
              <option value="month">Ãšltimo mes</option>
            </select>
          </div>
          <button id="applyFeedbackFilters" class="btn btn-primary">
            <span class="btn-icon">ğŸ”</span>
            Aplicar Filtros
          </button>
        </div>
      </div>

      <!-- LISTA DE FEEDBACK -->
      <div class="action-card">
        <div class="action-header">
          <h3>ğŸ“ Votaciones de Usuarios</h3>
        </div>
        <div id="feedbackContainer" class="feedback-list">
          <div class="loading-state">
            <div class="loading-icon">â³</div>
            <div>Cargando feedback...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- SECCIÃ“N 3: BASE DE CONOCIMIENTO -->
    <section id="knowledge-section" class="tab-content">
      <div class="section-header">
        <h2>ğŸ“š Base de Conocimiento</h2>
        <p class="section-description">
          Gestiona las preguntas y respuestas de la base de conocimiento del chatbot.
        </p>
      </div>

      <!-- ESTADÃSTICAS DE KB -->
      <div class="kb-stats">
        <div class="kb-stat">
          <div class="kb-stat-value" id="kbStatsTotal">0</div>
          <div class="kb-stat-label">ğŸ“ Total Entradas</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="kbStatsStudents">0</div>
          <div class="kb-stat-label">ğŸ“ Estudiantes</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="kbStatsTeachers">0</div>
          <div class="kb-stat-label">ğŸ‘¨â€ğŸ« Docentes</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="kbStatsAspirants">0</div>
          <div class="kb-stat-label">ğŸŒŸ Aspirantes</div>
        </div>
        <div class="kb-stat">
          <div class="kb-stat-value" id="kbStatsGeneral">0</div>
          <div class="kb-stat-label">ğŸ‘¥ Todos/Visitantes</div>
        </div>
      </div>

      <!-- CONTROLES DE KB -->
      <div class="action-card">
        <div class="action-header">
          <h3>ğŸ” Buscar en Base de Conocimiento</h3>
        </div>
        <div class="kb-search-controls">
          <div class="kb-search-row">
            <input type="text" id="kbSearchInput" placeholder="Buscar preguntas, respuestas o palabras clave..." class="kb-search-input">
            <button id="kbSearchBtn" class="btn btn-primary">
              <span class="btn-icon">ğŸ”</span>
              Buscar
            </button>
            <button id="kbClearSearch" class="btn btn-secondary">
              <span class="btn-icon">ğŸ—‘ï¸</span>
              Limpiar
            </button>
            <button id="refreshKnowledge" class="btn btn-info">
              <span class="btn-icon">ğŸ”„</span>
              Actualizar
            </button>
          </div>
        </div>
      </div>

      <!-- TABLA DE CONOCIMIENTO -->
      <div class="action-card">
        <div class="action-header">
          <h3>ğŸ“‹ Entradas de la Base de Conocimiento</h3>
        </div>
        <div class="kb-table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Pregunta</th>
                <th>Tipo Usuario</th>
                <th>Fuente</th>
                <th>Actualizado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="knowledgeTable">
              <tr>
                <td colspan="6" class="loading">
                  <div class="loading-state">
                    <div class="loading-icon">â³</div>
                    <div>Cargando base de conocimiento...</div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SECCIÃ“N 4: MANTENIMIENTO -->
    <section id="maintenance-section" class="tab-content">
      <div class="section-header">
        <h2>âš™ï¸ Mantenimiento del Sistema</h2>
        <p class="section-description">
          Panel principal para el mantenimiento del chatbot AvaUTS. 
          Las funciones principales estÃ¡n siempre visibles, las especÃ­ficas se pueden expandir segÃºn sea necesario.
        </p>
      </div>

      <!-- AUTENTICACIÃ“N -->
      <div id="authenticationCard" class="action-card">
        <div class="action-header">
          <h3>ğŸ” AutenticaciÃ³n de Administrador</h3>
          <span class="action-status" id="authStatus">No autenticado</span>
        </div>
        <p>Para usar las funciones de mantenimiento, primero debes autenticarte como administrador.</p>
        <div class="auth-form">
          <input type="password" id="adminToken" placeholder="Ingresa el token de administrador..." class="auth-input">
          <button id="authenticateBtn" class="btn btn-primary">
            <span class="btn-icon">ğŸ”‘</span>
            Autenticar
          </button>
        </div>
        <div id="authOutput" class="action-output"></div>
      </div>

      <div id="maintenanceControls" class="maintenance-controls" style="display: none;">
        <!-- ESTADO DEL SISTEMA -->
        <div class="action-card">
          <div class="action-header">
            <h3>ğŸ“Š Estado del Sistema</h3>
            <span class="action-status" id="systemStatus">Verificando...</span>
          </div>
          <p>InformaciÃ³n general sobre el estado del chatbot y sus componentes principales.</p>
          <div class="system-info">
            <div class="info-item">
              <span class="info-label">Servidor:</span>
              <span id="serverStatus" class="info-value">â€”</span>
            </div>
            <div class="info-item">
              <span class="info-label">Base de datos:</span>
              <span id="dbStatus" class="info-value">â€”</span>
            </div>
            <div class="info-item">
              <span class="info-label">IA (Gemini):</span>
              <span id="aiStatus" class="info-value">â€”</span>
            </div>
            <div class="info-item">
              <span class="info-label">Registros KB:</span>
              <span id="kbRecordsStatus" class="info-value">â€”</span>
            </div>
            <div class="info-item">
              <span class="info-label">Ãšltima actualizaciÃ³n:</span>
              <span id="lastUpdateStatus" class="info-value">â€”</span>
            </div>
          </div>
          <button id="checkSystemBtn" class="btn btn-info">
            <span class="btn-icon">ğŸ”</span>
            Verificar Estado
          </button>
        </div>

        <!-- MANTENIMIENTO AUTOMÃTICO -->
        <div class="action-card">
          <div class="action-header">
            <h3>ğŸ¤– Mantenimiento AutomÃ¡tico</h3>
            <span class="action-status" id="configStatus">Disponible</span>
          </div>
          <div class="auto-maintenance-description">
            <p><strong>Â¿QuÃ© hace este botÃ³n?</strong></p>
            <ul>
              <li>ğŸ” <strong>Revisa</strong> si hay cambios en el sitio web de UTS</li>
              <li>ğŸŒ <strong>Actualiza</strong> automÃ¡ticamente la informaciÃ³n del chatbot</li>
              <li>ğŸ‘¥ <strong>Sincroniza</strong> los datos de docentes</li>
              <li>ğŸ¯ <strong>Mejora</strong> las palabras clave para mejores respuestas</li>
            </ul>
            <div class="maintenance-note">
              <strong>ğŸ’¡ Para la secretaria:</strong> Presiona el botÃ³n verde y el sistema harÃ¡ todo solo. 
              TardarÃ¡ unos minutos y te avisarÃ¡ cuando termine. Â¡No necesitas saber nada tÃ©cnico!
            </div>
          </div>
          <div class="action-buttons">
            <button id="autoMaintenanceBtn" class="btn btn-success">
              <span class="btn-icon">ğŸ¤–</span>
              Mantenimiento AutomÃ¡tico
            </button>
            <button id="viewLogsBtn" class="btn btn-outline">
              <span class="btn-icon">ğŸ“‹</span>
              Ver Logs
            </button>
          </div>
          <div id="configOutput" class="action-output"></div>
        </div>

        <!-- SECCIÃ“N EXPANDIBLE PARA FUNCIONES ESPECÃFICAS -->
        <div class="specific-functions-section">
          <div class="expand-header" id="expandSpecificFunctions">
            <div class="expand-content">
              <h3>ğŸ”§ Mantenimiento EspecÃ­fico</h3>
              <p>Â¿Necesitas hacer algo especÃ­fico? Haz clic aquÃ­ para ver mÃ¡s opciones</p>
            </div>
            <div class="expand-toggle">
              <span class="expand-icon">â–¼</span>
            </div>
          </div>

          <div class="expandable-content" id="specificFunctionsContent">
            <div class="functions-tabs">
              <div class="function-tabs-nav">
                <button class="function-tab-btn active" data-target="automation-functions">
                  ğŸ¤– AutomatizaciÃ³n
                </button>
                <button class="function-tab-btn" data-target="teachers-functions">
                  ğŸ‘¥ Docentes  
                </button>
                <button class="function-tab-btn" data-target="search-functions">
                  ğŸ” BÃºsqueda
                </button>
                <button class="function-tab-btn" data-target="suggestions-functions">
                  ğŸ’¡ Sugerencias
                </button>
                <button class="function-tab-btn" data-target="scrapers-functions">
                  ğŸŒ Scrapers
                </button>
                <button class="function-tab-btn" data-target="operations-functions">
                  âš™ï¸ Operaciones
                </button>
              </div>

              <div class="function-tabs-content">
                <!-- AutomatizaciÃ³n -->
                <div id="automation-functions" class="function-tab-content active">
                  <div class="function-card">
                    <h4>ğŸ¤– Sistema de AutomatizaciÃ³n</h4>
                    <p>Controlar tareas automÃ¡ticas especÃ­ficas</p>
                    <div class="action-buttons">
                      <button class="btn btn-info" id="detectChangesBtn">ğŸ” Detectar Cambios</button>
                      <button class="btn btn-primary" id="autoUpdateBtn">ğŸ”„ Auto Update</button>
                    </div>
                    <div id="automationOutput" class="action-output"></div>
                  </div>
                </div>

                <!-- Docentes -->
                <div id="teachers-functions" class="function-tab-content">
                  <div class="function-card">
                    <h4>ğŸ‘¥ SincronizaciÃ³n de Docentes</h4>
                    <p>Gestionar informaciÃ³n especÃ­fica de docentes</p>
                    <div class="action-buttons">
                      <button class="btn btn-success" id="syncTeachersBtn">ğŸ‘¥ Sincronizar Docentes</button>
                      <button class="btn btn-info" id="checkTeachersBtn">ğŸ” Verificar Docentes</button>
                    </div>
                    <div id="teachersOutput" class="action-output"></div>
                  </div>
                </div>

                <!-- BÃºsqueda -->
                <div id="search-functions" class="function-tab-content">
                  <div class="function-card">
                    <h4>ğŸ” OptimizaciÃ³n de BÃºsqueda</h4>
                    <p>Mejorar la precisiÃ³n de las bÃºsquedas del chatbot</p>
                    <div class="action-buttons">
                      <button class="btn btn-warning" id="improveKeywordsBtn">ğŸ¯ Mejorar Keywords</button>
                      <button class="btn btn-info" id="generateSynonymsBtn">ğŸ“ Generar SinÃ³nimos</button>
                    </div>
                    <div id="searchOutput" class="action-output"></div>
                  </div>
                </div>

                <!-- Sugerencias -->
                <div id="suggestions-functions" class="function-tab-content">
                  <div class="function-card">
                    <h4>ğŸ’¡ Sugerencias EstÃ¡ticas</h4>
                    <p>Ver y regenerar sugerencias del chatbot</p>
                    <div class="action-buttons">
                      <button class="btn btn-info" id="viewSuggestionsEstudianteBtn">ğŸ‘¨â€ğŸ“ Estudiante</button>
                      <button class="btn btn-info" id="viewSuggestionsDocenteBtn">ğŸ‘¨â€ğŸ« Docente</button>
                      <button class="btn btn-info" id="viewSuggestionsAspiranteBtn">ğŸ¯ Aspirante</button>
                      <button class="btn btn-info" id="viewSuggestionsAllBtn">ğŸ“‹ Todas</button>
                      <button class="btn btn-success" id="regenerateSuggestionsBtn">ğŸ”„ Regenerar</button>
                    </div>
                    <div id="suggestionsOutput" class="action-output"></div>
                  </div>
                </div>

                <!-- Scrapers -->
                <div id="scrapers-functions" class="function-tab-content">
                  <div class="function-card">
                    <h4>ğŸŒ Scrapers Manuales</h4>
                    <p>Obtener datos especÃ­ficos manualmente</p>
                    <div class="action-buttons">
                      <button class="btn btn-primary" id="runScrapersBtn">ğŸŒ Ejecutar Scrapers</button>
                    </div>
                    <div id="scrapersOutput" class="action-output"></div>
                  </div>
                </div>

                <!-- Operaciones -->
                <div id="operations-functions" class="function-tab-content">
                  <div class="function-card">
                    <h4>âš™ï¸ Operaciones del Sistema</h4>
                    <p>Operaciones avanzadas de mantenimiento</p>
                    <div class="action-buttons">
                      <button class="btn btn-warning" id="reloadKbBtn">ğŸ“š Recargar KB</button>
                      <button class="btn btn-danger" id="backupDbBtn">ğŸ’¾ Backup BD</button>
                    </div>
                    <div id="operationsOutput" class="action-output"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>Hecho por Mario AndrÃ©s JÃ¡come Mantilla â€” Unidades TecnolÃ³gicas de Santander</span>
  </footer>

  <!-- Scripts modulares -->
  <script src="./js/metrics.js" defer></script>
  <script src="./js/feedback.js" defer></script>
  <script src="./js/knowledge.js" defer></script>
  <script src="./js/maintenance.js" defer></script>
  <script>
    // Sistema de temas y navegaciÃ³n de tabs
    const THEME_KEY = 'uts_theme';
    const htmlEl = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');

    function applyTheme(mode){
      htmlEl.setAttribute('data-theme', mode);
      localStorage.setItem(THEME_KEY, mode);
      themeToggle.textContent = mode === 'dark' ? 'ğŸŒ™' : (mode === 'light' ? 'â˜€ï¸' : 'ğŸŒ“');
    }

    (function initTheme(){
      let saved = localStorage.getItem(THEME_KEY) || 'light';
      // Migrar usuarios que tenÃ­an tema automÃ¡tico a tema claro
      if (saved === 'auto') {
        saved = 'light';
        localStorage.setItem(THEME_KEY, saved);
      }
      applyTheme(saved);
    })();

    themeToggle.addEventListener('click', () => {
      const current = htmlEl.getAttribute('data-theme') || 'light';
      const next = current === 'light' ? 'dark' : 'light';
      applyTheme(next);
    });

    // Sistema de navegaciÃ³n de tabs principales
    document.addEventListener('DOMContentLoaded', function() {
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const targetTab = this.dataset.tab;
          
          // Remover active de todos los botones y secciones
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Agregar active al botÃ³n clickeado y su secciÃ³n
          this.classList.add('active');
          document.getElementById(targetTab + '-section').classList.add('active');
          
          // Inicializar el mÃ³dulo correspondiente
          switch(targetTab) {
            case 'metrics':
              if (window.initMetrics) window.initMetrics();
              break;
            case 'feedback':
              if (window.initFeedback) window.initFeedback();
              break;
            case 'knowledge':
              if (window.initKnowledge) window.initKnowledge();
              break;
            case 'maintenance':
              if (window.initMaintenance) window.initMaintenance();
              break;
          }
        });
      });

      // Funcionalidad para secciones expandibles
      initExpandableSections();
      
      // Inicializar mÃ©tricas por defecto (secciÃ³n activa)
      if (window.initMetrics) {
        window.initMetrics();
      }
    });

    // FUNCIONALIDAD PARA SECCIONES EXPANDIBLES
    function initExpandableSections() {
      // Header expandible
      const expandHeader = document.getElementById('expandSpecificFunctions');
      const expandContent = document.getElementById('specificFunctionsContent');
      
      if (expandHeader && expandContent) {
        expandHeader.addEventListener('click', function() {
          const isExpanded = expandContent.classList.contains('expanded');
          
          if (isExpanded) {
            // Colapsar
            expandContent.classList.remove('expanded');
            expandHeader.classList.remove('expanded');
          } else {
            // Expandir
            expandContent.classList.add('expanded');
            expandHeader.classList.add('expanded');
          }
        });
      }
      
      // NavegaciÃ³n de tabs de funciones
      const tabButtons = document.querySelectorAll('.function-tab-btn');
      const tabContents = document.querySelectorAll('.function-tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          
          // Remover active de todos los botones y contenidos
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Agregar active al botÃ³n clickeado y su contenido
          this.classList.add('active');
          const targetContent = document.getElementById(targetId);
          if (targetContent) {
            targetContent.classList.add('active');
          }
        });
      });
    }
  </script>
</body>
</html>