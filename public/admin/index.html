<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Admin â€” AvaUTS v2.0.0</title>
  <link rel="stylesheet" href="./css/base.css" />
  <link rel="stylesheet" href="./css/metrics.css" />
  <link rel="stylesheet" href="./css/feedback.css" />
  <link rel="stylesheet" href="./css/knowledge.css" />
  <link rel="stylesheet" href="./css/maintenance.css" />
</head>
<body>
  <header class="header">
    <h1>
      <img src="/assets/animations/ChatbotVerdeUTS.gif" alt="AvaUTS">
      AvaUTS â€” Panel de AdministraciÃ³n v2.0
    </h1>
    <div class="header-controls">
      <button id="themeToggle" title="Tema">ğŸŒ“</button>
      <span class="badge">UTS</span>
    </div>
  </header>

  <nav class="nav-tabs">
    <button class="tab-btn active" data-tab="metrics">ğŸ“Š MÃ©tricas</button>
    <button class="tab-btn" data-tab="feedback">ğŸ’¬ Feedback</button>
    <button class="tab-btn" data-tab="knowledge">ğŸ“š Base de Conocimiento</button>
    <button class="tab-btn" data-tab="maintenance">âš™ï¸ Mantenimiento</button>
  </nav>

  <main class="container">
    <!-- SECCIÃ“N 1: MÃ‰TRICAS (solo lectura) -->
    <section id="metrics-section" class="tab-content active">
      <div class="section-header">
        <h2>ğŸ“Š MÃ©tricas del Sistema</h2>
        <button id="refreshMetrics" class="btn btn-outline">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 3V9M3 9H9M3 9L6.5 5.5C8.28 3.72 10.86 2.5 13.5 2.5C18.19 2.5 22 6.31 22 11C22 15.69 18.19 19.5 13.5 19.5C10.25 19.5 7.5 17.86 6.06 15.31" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Actualizar
        </button>
      </div>
      
      <div class="metrics-cards">
        <div class="metric-card">
          <div class="metric-icon">ğŸ’¬</div>
          <div class="metric-content">
            <div class="metric-title">Conversaciones Totales</div>
            <div id="totalConversations" class="metric-value">â€”</div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">ğŸ˜Š</div>
          <div class="metric-content">
            <div class="metric-title">SatisfacciÃ³n</div>
            <div id="satisfactionRate" class="metric-value">â€”%</div>
            <div class="progress">
              <div id="satisfactionBar" class="progress-bar" style="width:0%"></div>
            </div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">ğŸ“</div>
          <div class="metric-content">
            <div class="metric-title">Feedback Recibidos</div>
            <div id="feedbackTotal" class="metric-value">â€”</div>
            <small id="feedbackDetails" class="metric-details">â€” positivos, â€” negativos</small>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">ğŸ¤–</div>
          <div class="metric-content">
            <div class="metric-title">Modelo IA</div>
            <div id="modelName" class="metric-value">â€”</div>
            <small class="metric-details">Estado del servicio</small>
          </div>
        </div>
      </div>

      <div class="recent-conversations">
        <h3>Ãšltimas Conversaciones</h3>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Pregunta</th>
                <th>Respuesta (preview)</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody id="recentConversationsTable">
              <tr><td colspan="5" class="loading">Cargando...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SECCIÃ“N 2: FEEDBACK (solo lectura, con filtros) -->
    <section id="feedback-section" class="tab-content">
      <div class="section-header">
        <h2>ğŸ’¬ Feedback de Usuarios</h2>
        <div class="feedback-filters">
          <select id="feedbackType" class="filter-select">
            <option value="all">Todos</option>
            <option value="positive">Positivos</option>
            <option value="negative">Negativos</option>
          </select>
          <select id="feedbackPeriod" class="filter-select">
            <option value="all">Todo el tiempo</option>
            <option value="today">Hoy</option>
            <option value="week">Esta semana</option>
            <option value="month">Este mes</option>
          </select>
          <button id="applyFeedbackFilters" class="btn btn-outline">Filtrar</button>
        </div>
      </div>
      
      <div class="feedback-stats">
        <div class="stat-item">
          <span class="stat-label">Total:</span>
          <span id="feedbackStatsTotal" class="stat-value">â€”</span>
        </div>
        <div class="stat-item positive">
          <span class="stat-label">Positivos:</span>
          <span id="feedbackStatsPositive" class="stat-value">â€”</span>
        </div>
        <div class="stat-item negative">
          <span class="stat-label">Negativos:</span>
          <span id="feedbackStatsNegative" class="stat-value">â€”</span>
        </div>
      </div>

      <div class="feedback-list">
        <div id="feedbackContainer" class="feedback-items">
          <div class="loading">Cargando feedback...</div>
        </div>
      </div>
    </section>

    <!-- SECCIÃ“N 3: BASE DE CONOCIMIENTO (solo lectura y verificaciÃ³n) -->
    <section id="knowledge-section" class="tab-content">
      <div class="section-header">
        <h2>ğŸ“š Base de Conocimiento</h2>
        <div class="kb-info">
          <span class="info-text">ğŸ¯ VerificaciÃ³n de fuentes UTS</span>
          <button id="refreshKnowledge" class="btn btn-outline">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 3V9M3 9H9M3 9L6.5 5.5C8.28 3.72 10.86 2.5 13.5 2.5C18.19 2.5 22 6.31 22 11C22 15.69 18.19 19.5 13.5 19.5C10.25 19.5 7.5 17.86 6.06 15.31" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Actualizar
          </button>
        </div>
      </div>
      
      <div class="kb-search">
        <input type="text" id="kbSearchInput" placeholder="Buscar en la base de conocimiento..." class="search-input">
        <button id="kbSearchBtn" class="btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
            <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Buscar
        </button>
        <button id="kbClearSearch" class="btn btn-outline">Limpiar</button>
      </div>

      <div class="kb-stats">
        <div class="kb-stat">
          <span class="kb-stat-label">Entradas totales:</span>
          <span id="kbTotalEntries" class="kb-stat-value">â€”</span>
        </div>
        <div class="kb-stat">
          <span class="kb-stat-label">Ãšltima actualizaciÃ³n:</span>
          <span id="kbLastUpdate" class="kb-stat-value">â€”</span>
        </div>
        <div class="kb-stat">
          <span class="kb-stat-label">Fuentes verificadas:</span>
          <span id="kbVerifiedSources" class="kb-stat-value">â€”</span>
        </div>
      </div>

      <div class="kb-table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Pregunta/Tema</th>
              <th>Tipo Usuario</th>
              <th>Fuente UTS</th>
              <th>ActualizaciÃ³n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="knowledgeTable">
            <tr><td colspan="6" class="loading">Cargando base de conocimiento...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- SECCIÃ“N 4: MANTENIMIENTO (protegido con token) -->
    <section id="maintenance-section" class="tab-content">
      <div class="section-header">
        <h2>âš™ï¸ Mantenimiento del Sistema</h2>
        <div class="auth-status" id="authStatus">
          <span class="status-indicator" id="authIndicator">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
          </span>
          <span id="authText">No autenticado</span>
        </div>
      </div>

      <div class="auth-section" id="authSection">
        <div class="auth-card">
          <h3>ğŸ” AutenticaciÃ³n Requerida</h3>
          <p>Ingresa el token de administrador para acceder a las funciones de mantenimiento:</p>
          <div class="auth-input-group">
            <input type="password" id="adminToken" placeholder="ADMIN_TOKEN" class="auth-input">
            <button id="authenticateBtn" class="btn btn-primary">Autenticar</button>
          </div>
          <small class="auth-help">Solo el administrador del sistema puede ejecutar estas operaciones.</small>
        </div>
      </div>

      <div class="maintenance-actions" id="maintenanceActions" style="display: none;">
        <div class="action-grid">
          <!-- AUTOMATIZACIÃ“N -->
          <div class="action-card">
            <div class="action-header">
              <h3>ğŸ¤– Sistema de AutomatizaciÃ³n</h3>
              <span class="action-status" id="automationStatus">Listo</span>
            </div>
            <p>Control inteligente del sistema de automatizaciÃ³n para mantenimiento continuo.</p>
            <div class="action-buttons">
              <button id="detectChangesBtn" class="btn btn-info">
                <span class="btn-icon">ğŸ”</span>
                Detectar Cambios
              </button>
              <button id="autoUpdateBtn" class="btn btn-primary">
                <span class="btn-icon">ğŸ”„</span>
                ActualizaciÃ³n Completa
              </button>
              <button id="quickUpdateBtn" class="btn btn-secondary">
                <span class="btn-icon">âš¡</span>
                ActualizaciÃ³n RÃ¡pida
              </button>
            </div>
            <div id="automationOutput" class="action-output"></div>
          </div>

          <!-- SINCRONIZACIÃ“N DE DOCENTES -->
          <div class="action-card">
            <div class="action-header">
              <h3>ğŸ‘¨â€ğŸ« SincronizaciÃ³n de Docentes</h3>
              <span class="action-status" id="teacherSyncStatus">Listo</span>
            </div>
            <p>Actualiza automÃ¡ticamente las palabras clave con nombres de docentes para mejorar las bÃºsquedas por nombre especÃ­fico.</p>
            <div class="action-buttons">
              <button id="syncTeachersBtn" class="btn btn-primary">
                <span class="btn-icon">ğŸ”„</span>
                Sincronizar Docentes
              </button>
              <button id="checkTeachersBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ”</span>
                Verificar Cambios
              </button>
            </div>
            <div id="teacherSyncOutput" class="action-output"></div>
          </div>

          <!-- PALABRAS CLAVE Y SINÃ“NIMOS -->
          <div class="action-card">
            <div class="action-header">
              <h3>ğŸ”¤ OptimizaciÃ³n de BÃºsqueda</h3>
              <span class="action-status" id="optimizationStatus">Listo</span>
            </div>
            <p>Mejora automÃ¡tica de palabras clave y regeneraciÃ³n de sinÃ³nimos especÃ­ficos.</p>
            <div class="action-buttons">
              <button id="improveKeywordsBtn" class="btn btn-warning">
                <span class="btn-icon">ğŸ¯</span>
                Mejorar Keywords
              </button>
              <button id="generateSynonymsBtn" class="btn btn-success">
                <span class="btn-icon">ğŸ“</span>
                Generar SinÃ³nimos
              </button>
            </div>
            <div id="optimizationOutput" class="action-output"></div>
          </div>

          <!-- SUGERENCIAS INTELIGENTES -->
          <div class="action-card">
            <div class="action-header">
              <h3>ğŸ’¡ Sugerencias Inteligentes</h3>
              <span class="action-status" id="suggestionsStatus">Listo</span>
            </div>
            <p>Controla y actualiza las sugerencias inteligentes generadas con IA para cada tipo de usuario.</p>
            <div class="action-buttons">
              <button id="refreshAllSuggestionsBtn" class="btn btn-primary">
                <span class="btn-icon">ğŸ”„</span>
                Refrescar Todas
              </button>
              <button id="refreshEstudianteBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ“</span>
                Estudiantes
              </button>
              <button id="refreshDocenteBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ‘¨â€ğŸ«</span>
                Docentes
              </button>
              <button id="refreshAspiranteBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸŒŸ</span>
                Aspirantes
              </button>
              <button id="refreshVisitanteBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ‘‹</span>
                Visitantes
              </button>
            </div>
            <div id="suggestionsOutput" class="action-output"></div>
          </div>

          <!-- SCRAPERS TRADICIONALES -->
          <div class="action-card">
            <div class="action-header">
              <h3>ï¿½ï¸ Scrapers Manuales</h3>
              <span class="action-status" id="scrapersStatus">Listo</span>
            </div>
            <p>Ejecuta scrapers individuales para pÃ¡ginas especÃ­ficas de la UTS.</p>
            <div class="action-buttons">
              <button id="runAllScrapersBtn" class="btn btn-primary">
                <span class="btn-icon">â–¶ï¸</span>
                Todos los Scrapers
              </button>
              <button id="runAspirantesBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ‘¥</span>
                Aspirantes
              </button>
              <button id="runDocentesBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ‘¨â€ğŸ«</span>
                Docentes
              </button>
              <button id="runEstudiantesBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ“</span>
                Estudiantes
              </button>
              <button id="runTecnologiaBtn" class="btn btn-outline">
                <span class="btn-icon">ï¿½</span>
                TecnologÃ­a
              </button>
            </div>
            <div id="scrapersOutput" class="action-output"></div>
          </div>

          <!-- SISTEMA TRADICIONAL -->
          <div class="action-card">
            <div class="action-header">
              <h3>ï¿½ Operaciones del Sistema</h3>
              <span class="action-status" id="systemOpsStatus">Listo</span>
            </div>
            <p>Operaciones bÃ¡sicas del sistema como recarga de Ã­ndice y backups.</p>
            <div class="action-buttons">
              <button id="reloadKbBtn" class="btn btn-secondary">
                <span class="btn-icon">ğŸ”„</span>
                Recargar KB
              </button>
              <button id="backupDbBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ’¾</span>
                Crear Backup
              </button>
            </div>
            <div id="systemOpsOutput" class="action-output"></div>
          </div>

          <!-- MONITOREO EN TIEMPO REAL -->
          <div class="action-card">
            <div class="action-header">
              <h3>ğŸ“Š Monitoreo del Sistema</h3>
              <span class="action-status" id="monitoringStatus">Monitoreando</span>
            </div>
            <div class="system-info">
              <div class="info-item">
                <span class="info-label">Servidor:</span>
                <span id="serverStatus" class="info-value">â€”</span>
              </div>
              <div class="info-item">
                <span class="info-label">Base de datos:</span>
                <span id="dbStatus" class="info-value">â€”</span>
              </div>
              <div class="info-item">
                <span class="info-label">IA (Gemini):</span>
                <span id="aiStatus" class="info-value">â€”</span>
              </div>
              <div class="info-item">
                <span class="info-label">Registros KB:</span>
                <span id="kbRecordsStatus" class="info-value">â€”</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ãšltima actualizaciÃ³n:</span>
                <span id="lastUpdateStatus" class="info-value">â€”</span>
              </div>
            </div>
            <button id="checkSystemBtn" class="btn btn-info">
              <span class="btn-icon">ğŸ”</span>
              Verificar Estado
            </button>
          </div>

          <!-- CONFIGURACIÃ“N DE AUTOMATIZACIÃ“N -->
          <div class="action-card">
            <div class="action-header">
              <h3>âš™ï¸ ConfiguraciÃ³n AutomÃ¡tica</h3>
              <span class="action-status" id="configStatus">Disponible</span>
            </div>
            <p>Configurar tareas programadas para automatizaciÃ³n del sistema.</p>
            <div class="system-info">
              <div class="info-item">
                <span class="info-label">Estado de tareas:</span>
                <span id="scheduledTasksStatus" class="info-value">â€”</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ãšltima detecciÃ³n:</span>
                <span id="lastDetectionStatus" class="info-value">â€”</span>
              </div>
            </div>
            <div class="action-buttons">
              <button id="setupAutomationBtn" class="btn btn-success">
                <span class="btn-icon">âš™ï¸</span>
                Configurar Tareas
              </button>
              <button id="viewLogsBtn" class="btn btn-outline">
                <span class="btn-icon">ğŸ“‹</span>
                Ver Logs
              </button>
            </div>
            <div id="configOutput" class="action-output"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>Hecho por Mario AndrÃ©s JÃ¡come Mantilla â€” Unidades TecnolÃ³gicas de Santander</span>
  </footer>

  <!-- Scripts modulares -->
  <script src="./js/metrics.js" defer></script>
  <script src="./js/feedback.js" defer></script>
  <script src="./js/knowledge.js" defer></script>
  <script src="./js/maintenance.js" defer></script>
  <script>
    // Sistema de temas y navegaciÃ³n de tabs
    const THEME_KEY = 'uts_theme';
    const htmlEl = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');

    function applyTheme(mode){
      htmlEl.setAttribute('data-theme', mode);
      localStorage.setItem(THEME_KEY, mode);
      themeToggle.textContent = mode === 'dark' ? 'ğŸŒ™' : (mode === 'light' ? 'â˜€ï¸' : 'ğŸŒ“');
    }

    (function initTheme(){
      let saved = localStorage.getItem(THEME_KEY) || 'light';
      // Migrar usuarios que tenÃ­an tema automÃ¡tico a tema claro
      if (saved === 'auto') {
        saved = 'light';
        localStorage.setItem(THEME_KEY, saved);
      }
      applyTheme(saved);
    })();

    themeToggle.addEventListener('click', () => {
      const current = htmlEl.getAttribute('data-theme') || 'auto';
      const next = current === 'auto' ? 'dark' : current === 'dark' ? 'light' : 'auto';
      applyTheme(next);
    });

    // Sistema de navegaciÃ³n por tabs
    function initTabs() {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const targetTab = btn.dataset.tab;
          
          // Remover clases activas
          tabBtns.forEach(b => b.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Activar tab seleccionado
          btn.classList.add('active');
          document.getElementById(`${targetTab}-section`).classList.add('active');
          
          // Trigger de inicializaciÃ³n especÃ­fica por secciÃ³n
          if (window[`init${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`]) {
            window[`init${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`]();
          }
        });
      });
    }

    // Inicializar tabs cuando el DOM estÃ© listo
    document.addEventListener('DOMContentLoaded', initTabs);
  </script>
</body>
</html>
