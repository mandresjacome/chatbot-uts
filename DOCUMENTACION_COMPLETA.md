# üìã Documentaci√≥n Completa del Proyecto Chatbot UTS

## üéØ Informaci√≥n General del Proyecto

**Nombre**: Chatbot UTS v1.3.0  
**Prop√≥sito**: Chatbot inteligente especializado en **Ingenier√≠a de Sistemas** de las Unidades Tecnol√≥gicas de Santander (UTS)  
**Desarrollador**: Mario Andr√©s J√°come Mantilla  
**Repositorio**: https://github.com/mandresjacome/chatbot-uts  
**Tecnolog√≠as**: Node.js, Express, SQLite/Pos## üîÑ Estado Actual del Sistema - IMPORTANTE v1.3.0 (Septiembre 2025)

### ‚úÖ Componentes Completamente Funcionales y Optimizados
- **Web Scraping**: Extrae informaci√≥n actualizada de UTS (4 de 5 scrapers activos)
- **Chat con IA**: Gemini integrado con respuestas contextuales inteligentes
- **Sistema de Sugerencias**: ‚ú® **RENOVADO** - Est√°ticas instant√°neas sin APIs externas
- **B√∫squeda H√≠brida**: ‚ú® **NUEVO** - BD local + web complementaria controlada por usuario
- **Filtros Optimizados**: ‚úÖ **MEJORADO** - Balance perfecto relevancia/cobertura (Fuse.js)
- **Malla Curricular**: Navegaci√≥n completa con prerrequisitos y conexiones
- **Panel Admin**: ‚ú® **RENOVADO v1.3.0** - Interface profesional con autenticaci√≥n segura y funciones expandibles
- **Base de Conocimiento**: Actualizaci√≥n autom√°tica con sin√≥nimos inteligentes
- **Logging**: Sistema robusto de trazabilidad con rotaci√≥n autom√°tica
- **Detecci√≥n de Consultas**: Reconoce b√∫squedas de docentes y responde apropiadamente

### ‚ú® Nuevas Funcionalidades v1.3.0 - Revolucionarias
#### **üöÄ Sistema de Sugerencias Est√°ticas**
- **Performance**: 0ms vs 2-3s del sistema anterior
- **Reliability**: Sin dependencias externas vs APIs que pod√≠an fallar
- **Cost**: Sin costos adicionales vs llamadas Gemini
- **UX**: Respuesta inmediata perfecto para usuarios

#### **üîç B√∫squeda H√≠brida Inteligente**  
- **L√≥gica simple**: BD ‚Üí evidenceCount === 0 ‚Üí bot√≥n ‚Üí usuario decide
- **Control total**: Usuario tiene poder de decisi√≥n sobre b√∫squedas externas
- **No invasivo**: Solo aparece cuando realmente no hay informaci√≥n local
- **Complementario**: Enriquece respuestas sin saturar con datos irrelevantes

#### **‚ö° Filtros de Relevancia Optimizados**
- **Fix cr√≠tico**: Informaci√≥n existente ahora se detecta correctamente
- **Balance perfecto**: Threshold 0.4 + score ‚â§0.95 para cobertura √≥ptima
- **Validado**: Consultas sobre perfiles profesionales funcionan al 100%oogle Gemini AI, Scrapers Web, Sistema H√≠brido  
**Estado**: Completamente optimizado con mejoras revolucionarias en v1.3.0

### üöÄ Caracter√≠sticas Principales - ESTADO OPTIMIZADO v1.3.0 (Septiembre 2025)
- ‚úÖ **Chat inteligente especializado** en el programa de Ingenier√≠a de Sistemas UTS
- ‚úÖ **Sistema de sugerencias est√°ticas instant√°neas** - sin dependencias externas ni latencia
- ‚úÖ **B√∫squeda h√≠brida inteligente** - BD local + web complementaria controlada por usuario
- ‚úÖ **Filtros de relevancia optimizados** - balance perfecto entre precisi√≥n y cobertura
- ‚úÖ **Informaci√≥n actualizada** mediante scrapers autom√°ticos desde la web oficial UTS
- ‚úÖ **Malla curricular interactiva** con navegaci√≥n completa por semestres y materias
- ‚úÖ **Sistema de scrapers robustos** que mantiene sincronizaci√≥n con fuentes oficiales
- ‚úÖ **Detecci√≥n inteligente de consultas** (malla, informaci√≥n general, programas)
- ‚úÖ **Integraci√≥n con Gemini AI** para respuestas contextuales y naturales
- ‚úÖ **Base de datos dual** SQLite (desarrollo) / PostgreSQL (producci√≥n)
- ‚úÖ **Panel de administraci√≥n** ‚ú® **COMPLETAMENTE RENOVADO v1.3.0** con interface profesional:
  - **Autenticaci√≥n Segura**: Sistema de tokens con validaci√≥n del servidor
  - **3 Secciones Optimizadas**: Feedback, Knowledge Base y Mantenimiento renovadas
  - **Estad√≠sticas Horizontales**: Layouts profesionales con CSS Grid moderno
  - **Funciones Expandibles**: 6 herramientas de mantenimiento con navegaci√≥n por tabs
  - **Dise√±o Responsivo**: Adaptaci√≥n perfecta a todos los dispositivos
  - **UX Profesional**: Animaciones suaves, colores consistentes, navegaci√≥n intuitiva
- ‚úÖ **Sistema de feedback** para mejora continua de la calidad
- ‚úÖ **API REST completa** con endpoints especializados
- ‚úÖ **Logging avanzado** con diferentes niveles y archivos por fecha
- ‚úÖ **Respuestas apropiadas** cuando informaci√≥n no est√° disponible
- ‚ö†Ô∏è **Informaci√≥n de docentes**: NO DISPONIBLE (UTS elimin√≥ la secci√≥n de profesores)
- ‚úÖ **Manejo inteligente**: Detecta b√∫squedas de docentes y responde apropiadamente

---

## üìÅ Estructura Detallada del Proyecto

### üóÇÔ∏è Directorio Ra√≠z
```
chatbot-uts/
‚îú‚îÄ‚îÄ package.json              # Configuraci√≥n del proyecto Node.js
‚îú‚îÄ‚îÄ jest.config.json          # Configuraci√≥n de pruebas con Jest
‚îú‚îÄ‚îÄ README.md                 # Documentaci√≥n principal del proyecto
‚îú‚îÄ‚îÄ backup-test.db            # Backup de prueba de la base de datos
‚îú‚îÄ‚îÄ DOCUMENTACION_COMPLETA.md # Este archivo de documentaci√≥n
```

### üìÇ `/src` - C√≥digo Fuente Principal

#### üåê **`server.js`** - Servidor Principal
- **Funci√≥n**: Punto de entrada de la aplicaci√≥n
- **Caracter√≠sticas**:
  - Configuraci√≥n de Express.js con middlewares
  - Inicializaci√≥n de base de datos autom√°tica
  - Configuraci√≥n de CORS para peticiones cross-origin
  - Endpoints de salud y m√©tricas p√∫blicas
  - Rutas est√°ticas para archivos p√∫blicos
  - Sistema de logging integrado
  - Autenticaci√≥n admin para mantenimiento

#### üõ£Ô∏è **`/routes`** - Rutas de la API

##### **`chat.js`** - Endpoint Principal del Chatbot
- **Funci√≥n**: Maneja las conversaciones del chatbot
- **Endpoint**: `POST /api/chat/message`
- **Proceso**:
  1. Validaci√≥n de entrada (mensaje, tipo de usuario, sessionId)
  2. B√∫squeda de evidencia en base de conocimiento con retriever
  3. Generaci√≥n de respuesta con IA (Gemini)
  4. Persistencia de conversaci√≥n en base de datos
  5. Retorno de respuesta con referencias y metadatos
- **M√©tricas**: Tiempo de respuesta, evidencia encontrada, modelo usado

##### **`feedback.js`** - Sistema de Retroalimentaci√≥n
- **Funci√≥n**: Recopilar y almacenar feedback de usuarios
- **Endpoint**: `POST /api/feedback`
- **Datos**: rating (1-5), comentarios, sessionId, conversationId

##### **`admin.js`** - Rutas de Administraci√≥n
- **Funci√≥n**: Operaciones de mantenimiento protegidas
- **Autenticaci√≥n**: Middleware adminAuth con token
- **Operaciones**: Gesti√≥n de base de conocimiento, mantenimiento del sistema

#### üß† **`/ai`** - Integraci√≥n con Inteligencia Artificial

##### **`geminiClient.js`** - Cliente de Google Gemini
- **Funci√≥n**: Interfaz con la API de Google Gemini
- **Estado**: ‚úÖ TOTALMENTE FUNCIONAL CON MEJORAS
- **Caracter√≠sticas actuales**:
  - Soporte para m√∫ltiples modelos (gemini-2.5-flash por defecto)
  - Sistema de prompts optimizado "evidencia primero"
  - **Detecci√≥n inteligente de consultas de docentes**
  - **Manejo especializado cuando no hay datos de profesores**
  - Fallback a modo mock sin API key
  - Control de longitud de respuesta y evidencia
  - Manejo de errores y reintentos
- **Mejora clave**: Respuestas apropiadas para datos no disponibles
- **Ejemplo respuesta docentes**: "No encontr√© informaci√≥n espec√≠fica del docente, te sugiero contactar coordinaci√≥n acad√©mica"

##### **`webSearcher.js`** - Motor de B√∫squeda Web Complementaria ‚ú® NUEVO v1.3.0
- **Funci√≥n**: B√∫squeda inteligente en fuentes externas cuando BD local no es suficiente
- **Estado**: ‚úÖ TOTALMENTE FUNCIONAL
- **Caracter√≠sticas**:
  - B√∫squeda autom√°tica en fuentes confiables
  - Procesamiento de resultados y relevancia
  - Integraci√≥n con interfaz de usuario
  - Control activado por usuario (no autom√°tico)
- **Trigger**: Solo cuando evidenceCount === 0 y usuario hace clic en bot√≥n
- **Beneficio**: Informaci√≥n complementaria sin saturar con b√∫squedas innecesarias

#### üóÑÔ∏è **`/db`** - Capa de Base de Datos

##### **`index.js`** - Abstracci√≥n de Base de Datos
- **Funci√≥n**: Capa de abstracci√≥n para SQLite/PostgreSQL
- **Caracter√≠sticas**:
  - Conexi√≥n autom√°tica seg√∫n variables de entorno
  - Bootstrap autom√°tico del esquema
  - Funciones de consulta unificadas
  - Manejo de transacciones

##### **`repositories.js`** - Repositorios de Datos
- **Funci√≥n**: Operaciones CRUD especializadas
- **Repositorios**:
  - `Conversations`: Gesti√≥n de conversaciones del chat
  - `Feedback`: Almacenamiento de valoraciones
  - `KnowledgeBase`: Base de conocimiento UTS

##### **`database.js`** - Adaptador de Compatibilidad
- **Funci√≥n**: Compatibilidad con scrapers CJS existentes
- **Caracter√≠sticas**: Traduce placeholders entre SQLite y PostgreSQL

#### üß† **`/nlp`** - Procesamiento de Lenguaje Natural

##### **`retriever.js`** - Sistema de Recuperaci√≥n
- **Funci√≥n**: B√∫squeda inteligente en base de conocimiento
- **Estado**: ‚úÖ TOTALMENTE OPTIMIZADO v1.3.0
- **Tecnolog√≠as**:
  - **Fuse.js**: B√∫squeda difusa tolerante a errores
  - **compromise**: An√°lisis de entidades y fechas
  - **Sin√≥nimos**: Expansi√≥n autom√°tica de consultas
- **Configuraci√≥n Optimizada**: 
  - **Threshold**: 0.4 (balance perfecto relevancia/cobertura)
  - **Score Filter**: ‚â§0.95 (detecta contenido existente que antes se perd√≠a)
  - **Pesos ajustados**: palabras clave 50%, pregunta 30%, contenido 20%
- **Filtros**: Por tipo de usuario (aspirante, estudiante, docente, todos)
- **Mejora cr√≠tica**: Fix para detectar informaci√≥n v√°lida que exist√≠a pero no se encontraba

##### **`staticSuggestions.js`** - Sistema de Sugerencias Est√°ticas ‚ú® NUEVO v1.3.0
- **Funci√≥n**: Sugerencias instant√°neas sin dependencias externas
- **Estado**: ‚úÖ TOTALMENTE FUNCIONAL
- **Caracter√≠sticas**:
  - **4 categor√≠as de usuario**: estudiante, docente, aspirante, todos
  - **Respuesta instant√°nea**: 0ms de latencia vs 2-3s del sistema anterior
  - **Sin dependencias**: No requiere APIs externas ni Gemini
  - **Contexto espec√≠fico**: Sugerencias relevantes por perfil
- **Reemplaza**: Sistema anterior basado en Gemini que era lento y costoso
- **Formato**: Array de objetos {text, type, category} listo para UI

##### **`teacherSearch.js`** - B√∫squeda de Docentes
- **Funci√≥n**: Detecci√≥n especializada de consultas sobre profesores
- **Estado**: ‚úÖ FUNCIONAL (detecta consultas, responde apropiadamente)
- **Comportamiento actual**:
  - Detecta b√∫squedas de profesores con alta precisi√≥n
  - No retorna datos espec√≠ficos (fuente no disponible)
  - Proporciona respuesta √∫til con alternativas de contacto
- **Conservado**: Sistema preparado para reactivaci√≥n si UTS restaura informaci√≥n

##### **`synonyms.js`** - Sin√≥nimos Generados
- **Funci√≥n**: Sin√≥nimos espec√≠ficos para mejorar b√∫squedas
- **Estado**: ‚úÖ ACTIVO Y ACTUALIZADO
- **Generaci√≥n**: Autom√°tica basada en an√°lisis de contenido UTS disponible
- **Categor√≠as**: 21+ grupos de sin√≥nimos espec√≠ficos por dominio
- **Actualizaci√≥n**: Regeneraci√≥n autom√°tica con cambios de contenido
- **Nota**: Ya no incluye sin√≥nimos de nombres de profesores espec√≠ficos

##### **`kbLoader.js`** - Cargador de Base de Conocimiento
- **Funci√≥n**: Carga y sincronizaci√≥n de KB desde base de datos
- **Estado**: ‚úÖ COMPLETAMENTE FUNCIONAL
- **Caracter√≠sticas**: Procesamiento de texto para b√∫squeda optimizada
- **Filtra**: Autom√°ticamente contenido obsoleto o sin datos

#### üõ†Ô∏è **`/utils`** - Utilidades del Sistema

##### **`logger.js`** - Sistema de Logging
- **Funci√≥n**: Logging estructurado del sistema
- **Caracter√≠sticas**:
  - Logs categorizados (CHAT, AI, DB, SYSTEM, etc.)
  - Timestamps autom√°ticos
  - Diferentes niveles de log
  - Formato legible y parseable

##### **`normalize.js`** - Normalizaci√≥n de Texto
- **Funci√≥n**: Limpieza y normalizaci√≥n de consultas
- **Caracter√≠sticas**: Eliminaci√≥n de acentos, espacios, caracteres especiales

##### **`id.js`** - Generaci√≥n de Identificadores
- **Funci√≥n**: Generaci√≥n de sessionIds √∫nicos para conversaciones

##### **`database-adapter.cjs`** - Adaptador CJS
- **Funci√≥n**: Compatibilidad con scrapers CommonJS existentes

#### üîê **`/middlewares`** - Middlewares de Express

##### **`adminAuth.js`** - Autenticaci√≥n de Administrador
- **Funci√≥n**: Protecci√≥n de rutas de mantenimiento
- **M√©todo**: Token-based authentication
- **Variable**: `ADMIN_TOKEN` environment variable

#### üìä **`/data`** - Datos del Sistema

##### **`knowledge.json`** - Base de Conocimiento Legacy
- **Funci√≥n**: Base de conocimiento inicial (migrada a SQLite)
- **Estado**: Mantenida para compatibilidad

### üìÇ `/public` - Archivos P√∫blicos e Interfaces

#### üé® **P√°gina Principal** (`index.html`)
- **Funci√≥n**: Demostraci√≥n del widget flotante
- **Caracter√≠sticas**: Widget embebido, m√∫ltiples temas, responsive

#### üí¨ **`/chat`** - Interfaz de Chat Directo RENOVADA v1.3.0
- **Archivos**:
  - `index.html`: P√°gina principal del chat
  - `chat.css`: Estilos del chat
  - **`js/modules/chat.js`**: ‚úÖ RENOVADO - L√≥gica simplificada del chat
  - **`js/components/advanced-search.js`**: ‚ú® NUEVO - Interfaz de b√∫squeda web
  - `widget.js`: Widget embebible
  - `modal-user.js/.css`: Modal para selecci√≥n de perfil
- **Temas**: 4 temas visuales (aspirante, estudiante, docente, visitante)
- **Nueva funcionalidad**: Control de b√∫squeda web complementaria
- **Mejoras UX**: Sugerencias instant√°neas y b√∫squeda h√≠brida controlada

#### üîß **`/admin`** - Panel de Administraci√≥n ‚ú® COMPLETAMENTE RENOVADO v1.3.0
- **Funci√≥n**: Interface web profesional completamente redise√±ada para administradores
- **Estado**: ‚úÖ FUNCIONAL al 100% con mejoras revolucionarias en UX/UI
- **Autenticaci√≥n**: Sistema seguro con token (admin123) y validaci√≥n del servidor

##### **üìä Secciones Principales Renovadas**:
1. **üí¨ Feedback** (Secci√≥n 1):
   - **Estad√≠sticas Horizontales**: 4 m√©tricas organizadas profesionalmente
   - **Clasificaci√≥n por Importancia**: Total, Positivos, Negativos, Neutros
   - **Dise√±o Moderno**: CSS Grid responsivo con colores distintivos

2. **üìö Knowledge Base** (Secci√≥n 2):
   - **5 Categor√≠as de Estad√≠sticas**: Distribuci√≥n completa del conocimiento
   - **Layout Horizontal Optimizado**: Controles de b√∫squeda en l√≠nea
   - **Navegaci√≥n Fluida**: Exploraci√≥n y verificaci√≥n de fuentes mejorada

3. **üîß Mantenimiento** (Secci√≥n 3) - ‚ú® RENOVACI√ìN COMPLETA:
   - **Autenticaci√≥n Mejorada**: Flujo seguro con validaci√≥n en tiempo real
   - **6 Funciones Expandibles**: Sistema de navegaci√≥n por tabs
   - **Interfaz Profesional**: Animaciones suaves y transiciones elegantes
   - **Funciones Disponibles**: Estado del sistema, logs, limpieza DB, respaldo, restart, an√°lisis

##### **üé® Arquitectura CSS Modular Renovada**:
- `css/base.css`: Variables CSS y estilos base unificados
- `css/feedback.css`: ‚ú® **NUEVO** - Estad√≠sticas horizontales profesionales
- `css/knowledge.css`: ‚ú® **RENOVADO** - Grid de 5 estad√≠sticas + controles horizontales  
- `css/maintenance.css`: ‚ú® **COMPLETAMENTE NUEVO** - Sistema expandible con tabs
- `css/responsive.css`: Media queries para adaptaci√≥n m√≥vil perfecta

##### **‚öôÔ∏è JavaScript Modular Mejorado**:
- `js/feedback.js`: Gesti√≥n de estad√≠sticas con layouts horizontales
- `js/knowledge.js`: ‚ú® **RENOVADO** - 5 categor√≠as de estad√≠sticas KB optimizadas
- `js/maintenance.js`: ‚ú® **COMPLETAMENTE RENOVADO** - Sistema de autenticaci√≥n + tabs expandibles

##### **üöÄ Beneficios de la Renovaci√≥n v1.3.0**:
- **UX Profesional**: Interfaz moderna con navegaci√≥n intuitiva
- **Responsive Design**: Adaptaci√≥n perfecta a todos los dispositivos  
- **Performance Optimizada**: CSS Grid y Flexbox para layouts eficientes
- **Mantenabilidad**: C√≥digo modular y bien documentado
- **Seguridad Mejorada**: Autenticaci√≥n robusta con validaci√≥n del servidor

#### üñºÔ∏è **Recursos Visuales**
- **GIFs Animados**: 5 avatares del chatbot por tipo de usuario
- **logoUTS.webp**: Logo oficial de la UTS
- **Temas CSS**: Colores espec√≠ficos por perfil de usuario

### üìÇ `/scripts` - Scripts de Automatizaci√≥n

#### ü§ñ **`auto-update-system.cjs`** - Sistema Principal de Automatizaci√≥n
- **Funci√≥n**: Orquestador principal del sistema de actualizaci√≥n
- **Estado**: ‚úÖ ACTIVO
- **Operaciones**:
  - `fullUpdate()`: Actualizaci√≥n completa (scrapers + keywords + sin√≥nimos)
  - `quickUpdate()`: Actualizaci√≥n r√°pida (solo optimizaci√≥n)
  - `checkContent()`: Verificaci√≥n de nuevo contenido
- **Reportes**: M√©tricas detalladas de cada operaci√≥n

#### üîç **`change-detector.cjs`** - Detector de Cambios
- **Funci√≥n**: Monitoreo autom√°tico de cambios en p√°ginas UTS
- **Estado**: ‚úÖ ACTIVO
- **Caracter√≠sticas**:
  - Cache de snapshots anteriores
  - Detecci√≥n granular de modificaciones
  - Triggers autom√°ticos de actualizaci√≥n
  - Sistema de umbral para evitar false positives

#### üéØ **`improve-keywords.cjs`** - Optimizador de Palabras Clave
- **Funci√≥n**: Mejora autom√°tica de keywords para b√∫squeda
- **Estado**: ‚úÖ ACTIVO
- **Algoritmo**: An√°lisis de frecuencia y relevancia
- **Actualizaci√≥n**: Modificaci√≥n directa en base de datos

#### üìù **`generate-synonyms.cjs`** - Generador de Sin√≥nimos
- **Funci√≥n**: Creaci√≥n autom√°tica de sin√≥nimos espec√≠ficos UTS
- **Estado**: ‚úÖ ACTIVO
- **M√©todo**: An√°lisis del corpus de conocimiento
- **Salida**: Archivo `synonyms.js` actualizado

#### üï∑Ô∏è **`run-scrapers.cjs`** - Ejecutor de Scrapers
- **Funci√≥n**: Coordinaci√≥n de todos los scrapers web
- **Estado**: ‚úÖ ACTIVO
- **Scrapers incluidos**: aspirantes, estudiantes, tecnolog√≠a, fixed
- **Scraper obsoleto**: docentes (conservado por compatibilidad)

#### üîÑ **`sync-teacher-keywords.cjs`** - Sincronizador de Docentes
- **Funci√≥n**: Sincronizaci√≥n de informaci√≥n de profesores
- **Estado**: ‚ö†Ô∏è OBSOLETO (conservado por compatibilidad)
- **Raz√≥n**: UTS elimin√≥ la secci√≥n de informaci√≥n de docentes

#### ‚öôÔ∏è **Scripts de Configuraci√≥n y Validaci√≥n**
- **`deploy-init.cjs`**: ‚úÖ Script de inicializaci√≥n para deploy
- **`setup-teacher-sync.cjs`**: ‚ö†Ô∏è OBSOLETO (configuraci√≥n para sincronizaci√≥n de docentes)
- **`validate-suggestions.mjs`**: ‚úÖ Validador de sugerencias del sistema est√°tico

### üìÇ `/scrapers` - Extractores de Contenido Web

#### üéØ **Scrapers Especializados - ESTADO ACTUAL**:
- **`scraper_aspirantes.cjs`**: ‚úÖ ACTIVO - Informaci√≥n para futuros estudiantes
- **`scraper_estudiantes.cjs`**: ‚úÖ ACTIVO - Servicios y tr√°mites estudiantiles
- **`scraper_tecnologia.cjs`**: ‚úÖ ACTIVO - Programas tecnol√≥gicos espec√≠ficos
- **`scraper_fixed.cjs`**: ‚úÖ ACTIVO - Informaci√≥n general y est√°tica
- **`scraper_docentes.cjs`**: ‚ö†Ô∏è OBSOLETO - Recursos y procedimientos para docentes (conservado por compatibilidad)

#### ‚ö†Ô∏è **Importante - Scraper de Docentes**:
- **Estado**: No funcional desde septiembre 2024
- **Raz√≥n**: UTS elimin√≥ la secci√≥n de informaci√≥n de profesores del sitio web oficial
- **Comportamiento**: El script se ejecuta pero no encuentra contenido para extraer
- **Conservaci√≥n**: Se mantiene el archivo para compatibilidad y posible reactivaci√≥n futura

#### üîß **Caracter√≠sticas de los Scrapers Activos**:
- **Robustez**: Manejo de errores de red y parsing
- **Selectores inteligentes**: Adaptaci√≥n a cambios menores en HTML
- **Categorizaci√≥n autom√°tica**: Asignaci√≥n de tipo de usuario
- **Procesamiento de texto**: Limpieza y estructuraci√≥n de contenido
- **Cache de resultados**: Evita re-procesamiento innecesario
- **Detecci√≥n de cambios**: Solo actualiza cuando hay modificaciones reales

### üìÇ `/tests` - Suite de Pruebas

#### üß™ **`chat.test.js`** - Pruebas de la API de Chat
- **Framework**: Jest + Supertest
- **Cobertura**:
  - Validaci√≥n de entrada (mensajes vac√≠os)
  - Modo mock vs. modo real
  - Manejo de evidencia
  - Respuestas de fallback
- **Configuraci√≥n**: `jest.config.json` con soporte ES modules

### üìÇ `/cache` - Cache del Sistema

#### üíæ **Archivos de Cache**:
- **`database.json`**: Estado anterior de la base de datos
- **`web_*.json`**: Snapshots de p√°ginas web monitoreadas
- **`detection_report.json`**: √öltimo reporte de detecci√≥n de cambios

### üìÇ `/logs` - Sistema de Logging

#### üìã **Archivos de Log**:
- **`chatbot-YYYY-MM-DD.log`**: Logs diarios del chatbot
- **`automation.log`**: Logs espec√≠ficos de automatizaci√≥n (Unix)

### üìÇ `/config` - Configuraci√≥n del Sistema

#### ‚öôÔ∏è **`automation.json`** - Configuraci√≥n de Automatizaci√≥n
- **Secciones**:
  - `automation`: Habilitaci√≥n y modo del sistema
  - `schedules`: Frecuencias de ejecuci√≥n (cron format)
  - `monitoring`: URLs monitoreadas y timeouts
  - `updates`: Configuraci√≥n de actualizaciones autom√°ticas
  - `performance`: L√≠mites de recursos del sistema
  - `logging`: Configuraci√≥n avanzada de logs

---

## üîß Configuraci√≥n y Funcionamiento

### üåç Variables de Entorno

```bash
# Obligatorias
GEMINI_API_KEY=tu_api_key_de_google_gemini  # Clave API de Google Gemini

# Opcionales con valores por defecto
PORT=3001                    # Puerto del servidor
NODE_ENV=development         # Entorno de ejecuci√≥n
USE_LLM=gemini              # Modo de IA (gemini/mock)
GEMINI_MODEL=gemini-2.5-flash # Modelo espec√≠fico de Gemini
ADMIN_TOKEN=admin123        # Token para operaciones de admin

# Base de datos (autom√°tica)
DATABASE_URL=               # PostgreSQL URL (si no se define, usa SQLite)
DB_SQLITE_PATH=./src/db/database.db  # Ruta de SQLite por defecto

# L√≠mites del sistema
MAX_CHARS_EVIDENCE=2500     # M√°ximo caracteres de evidencia para IA
MAX_CHARS_RESPONSE=1200     # M√°ximo caracteres de respuesta
```

### üöÄ Scripts de Package.json

```bash
# Desarrollo
npm run dev                 # Servidor con nodemon (hot-reload)
npm start                   # Servidor de producci√≥n

# Testing
npm test                    # Ejecutar pruebas con Jest

# Scrapers individuales
npm run scraper:aspirantes  # Scraper de aspirantes
npm run scraper:docentes    # Scraper de docentes
npm run scraper:estudiantes # Scraper de estudiantes
npm run scraper:tecnologia  # Scraper de tecnolog√≠a
npm run scraper:fixed       # Scraper de informaci√≥n general
npm run scrapers            # Todos los scrapers

# Optimizaci√≥n del sistema
npm run improve-keywords    # Mejorar palabras clave
npm run generate-synonyms   # Generar sin√≥nimos autom√°ticos

# Automatizaci√≥n
npm run auto-update         # Actualizaci√≥n completa del sistema
npm run auto-update-quick   # Actualizaci√≥n r√°pida (sin scrapers)
npm run detect-changes      # Detectar cambios en p√°ginas web
npm run auto-check-update   # Actualizar solo si hay cambios

# Configuraci√≥n
npm run setup-automation    # Informaci√≥n para configurar tareas autom√°ticas
```

---

## ÔøΩ Estado Actual del Sistema - IMPORTANTE (Septiembre 2025)

### ‚úÖ Componentes Completamente Funcionales
- **Web Scraping**: Extrae informaci√≥n actualizada de UTS (4 de 5 scrapers activos)
- **Chat con IA**: Gemini integrado con respuestas contextuales inteligentes
- **Malla Curricular**: Navegaci√≥n completa con prerrequisitos y conexiones
- **Panel Admin**: Gesti√≥n completa del sistema con m√©tricas en tiempo real
- **Base de Conocimiento**: Actualizaci√≥n autom√°tica con sin√≥nimos inteligentes
- **Logging**: Sistema robusto de trazabilidad con rotaci√≥n autom√°tica
- **Detecci√≥n de Consultas**: Reconoce b√∫squedas de docentes y responde apropiadamente

### üîÑ Componentes Obsoletos/Eliminados (Optimizaci√≥n v1.3.0)
- **suggestionsGenerator.js**: ‚ùå **ELIMINADO** - Sistema Gemini lento reemplazado por est√°tico
- **An√°lisis complejo de respuestas**: ‚ùå **ELIMINADO** - Causaba bugs, reemplazado por l√≥gica simple
- **Informaci√≥n de Docentes**: ‚ö†Ô∏è NO DISPONIBLE (UTS elimin√≥ la secci√≥n de profesores)
- **`scraper_docentes.cjs`**: ‚ö†Ô∏è CONSERVADO sin funci√≥n (por compatibilidad)
- **Cache de docentes**: ‚ö†Ô∏è Contiene datos hist√≥ricos de septiembre 2024

### ÔøΩüîÑ Componentes Obsoletos (Conservados por Compatibilidad)
- **`scraper_docentes.cjs`**: No extrae datos (fuente eliminada por UTS)
- **`sync-teacher-keywords.cjs`**: No sincroniza nombres (sin datos fuente)
- **Cache de docentes**: Contiene datos hist√≥ricos de septiembre 2024

### üéØ Respuesta Actual v1.3.0 - Mejorada
#### **Para B√∫squedas de Docentes**:
```
‚ùå No encontr√© informaci√≥n del docente "[nombre]" en los datos disponibles 
   del programa de Ingenier√≠a de Sistemas.

üí° Te puedo ayudar con:
- üìã Informaci√≥n general del programa  
- üéì Malla curricular y materias
- üìû Contacto de coordinaci√≥n acad√©mica
- üèõÔ∏è Requisitos de admisi√≥n

ÔøΩ ¬øTe gustar√≠a buscar informaci√≥n complementaria en la web? [Bot√≥n de B√∫squeda Web]
```

#### **Para Consultas sin Evidencia**:
```
üìù Respuesta: [Respuesta contextual de Gemini]
üîç ¬øTe gustar√≠a buscar informaci√≥n complementaria en la web? [Bot√≥n - Solo si evidenceCount === 0]
üí° Sugerencias: [Sugerencias est√°ticas instant√°neas seg√∫n perfil]
```

### üöÄ Sistema Preparado para el Futuro
Si UTS restaura la informaci√≥n de docentes:
1. ‚úÖ `scraper_docentes.cjs` reactivable inmediatamente
2. ‚úÖ `teacherSearch.js` mantiene toda la l√≥gica de detecci√≥n
3. ‚úÖ `sync-teacher-keywords.cjs` listo para sincronizaci√≥n
4. ‚úÖ Base de conocimiento expandible autom√°ticamente
5. ‚úÖ Sin cambios necesarios en c√≥digo principal

## üîÑ Flujo de Funcionamiento Actual

### üí¨ **Proceso de Chat Renovado v1.3.0**
1. **Usuario env√≠a mensaje** ‚Üí `POST /api/chat/message`
2. **Validaci√≥n de entrada** ‚Üí sessionId, userType, message
3. **Detecci√≥n especializada** ‚Üí Identifica si busca docentes, malla curricular, etc.
4. **B√∫squeda de evidencia OPTIMIZADA** ‚Üí Fuse.js con filtros mejorados en base de conocimiento
5. **Expansi√≥n con sin√≥nimos** ‚Üí Mejora la b√∫squeda con t√©rminos relacionados
6. **Filtro por tipo de usuario** ‚Üí aspirante/estudiante/docente/todos
7. **Procesamiento inteligente en IA**:
   - Si busca docentes ‚Üí Respuesta espec√≠fica sobre limitaci√≥n + alternativas + bot√≥n web
   - Si evidenceCount === 0 ‚Üí Respuesta + bot√≥n de b√∫squeda web opcional
   - Si hay evidencia ‚Üí Respuesta normal contextual
8. **Sugerencias instant√°neas** ‚Üí Sistema est√°tico por perfil de usuario (0ms)
9. **Persistencia en BD** ‚Üí Conversaci√≥n guardada para m√©tricas
10. **Respuesta optimizada** ‚Üí JSON con respuesta, sugerencias instant√°neas, bot√≥n web condicional

### üï∑Ô∏è **Proceso de Scraping Actualizado**
1. **Ejecuci√≥n programada/manual** ‚Üí Scripts de scraping coordinados
2. **Verificaci√≥n de fuentes** ‚Üí Check de disponibilidad de cada URL UTS
3. **Descarga selectiva** ‚Üí Solo p√°ginas con contenido disponible:
   - ‚úÖ Aspirantes, Estudiantes, Tecnolog√≠a, Informaci√≥n General
   - ‚ö†Ô∏è Docentes: Se ejecuta pero no encuentra contenido v√°lido
4. **Extracci√≥n de contenido** ‚Üí Cheerio + selectores CSS optimizados
5. **Procesamiento de texto** ‚Üí Limpieza y estructuraci√≥n inteligente
6. **Categorizaci√≥n autom√°tica** ‚Üí Asignaci√≥n de tipo de usuario
7. **Validaci√≥n de contenido** ‚Üí Descarta datos vac√≠os o inv√°lidos
8. **Almacenamiento en BD** ‚Üí Insert/Update solo con contenido v√°lido
9. **Generaci√≥n de keywords** ‚Üí An√°lisis autom√°tico de relevancia
10. **Actualizaci√≥n de sin√≥nimos** ‚Üí Regeneraci√≥n basada en contenido real

### ü§ñ **Proceso de Automatizaci√≥n Inteligente Actualizado v1.3.0**
1. **Detecci√≥n de cambios** ‚Üí Comparaci√≥n con cache anterior por URL
2. **Filtro inteligente** ‚Üí Ignora p√°ginas sin contenido v√°lido (ej: docentes)
3. **Trigger condicional** ‚Üí Solo actualiza si hay cambios reales
4. **Ejecuci√≥n selectiva de scrapers** ‚Üí Solo ejecuta scrapers con fuentes activas
5. **Optimizaci√≥n autom√°tica** ‚Üí Keywords y sin√≥nimos basados en contenido real
6. **Actualizaci√≥n de sugerencias** ‚Üí ‚ú® NUEVO: Regeneraci√≥n de sugerencias est√°ticas
7. **Validaci√≥n de BD** ‚Üí Verificaci√≥n de integridad y limpieza de datos obsoletos
8. **Recarga del sistema** ‚Üí Retriever y cache actualizado con datos v√°lidos
9. **Optimizaci√≥n de filtros** ‚Üí ‚ú® NUEVO: Ajuste autom√°tico de thresholds seg√∫n performance
10. **Generaci√≥n de reportes** ‚Üí M√©tricas detalladas incluyendo limitaciones conocidas

---

## üìä Arquitectura del Sistema

### üèóÔ∏è **Patr√≥n Arquitect√≥nico**: MVC + Microservicios
- **Model**: Repositorios de datos (`/db/repositories.js`)
- **View**: Interfaces web (`/public/*`)
- **Controller**: Rutas y l√≥gica de negocio (`/routes/*`)
- **Services**: NLP, AI, Scrapers como servicios independientes

### üß© **Componentes Principales**:

#### üåê **API Layer**
- Express.js con middlewares
- CORS configurado para desarrollo
- Autenticaci√≥n basada en tokens
- Rate limiting impl√≠cito

#### üß† **Intelligence Layer**
- **Retriever**: B√∫squeda sem√°ntica con Fuse.js
- **AI Client**: Integraci√≥n con Google Gemini
- **NLP**: Procesamiento con compromise
- **Synonyms**: Expansi√≥n autom√°tica de consultas

#### üóÑÔ∏è **Data Layer**
- **SQLite**: Base de datos principal (desarrollo)
- **PostgreSQL**: Soporte para producci√≥n
- **Abstraction**: Capa unificada para ambas BD
- **Migrations**: Bootstrap autom√°tico de esquema

#### üï∑Ô∏è **Scraping Layer**
- **Scrapers especializados**: Por tipo de contenido UTS
- **Change Detection**: Monitoreo autom√°tico de modificaciones
- **Content Processing**: Limpieza y estructuraci√≥n de datos
- **Batch Processing**: Ejecuci√≥n coordinada de m√∫ltiples scrapers

#### ü§ñ **Automation Layer**
- **Smart Updates**: Actualizaciones inteligentes desde panel admin
- **Web Interface**: Control completo desde interfaz web autenticada
- **Performance Monitoring**: M√©tricas de recursos y tiempo
- **Error Recovery**: Manejo robusto de fallos

---

## üîê Seguridad

### üõ°Ô∏è **Medidas Implementadas**:
- **Autenticaci√≥n**: Token-based para operaciones admin
- **Validaci√≥n de entrada**: Sanitizaci√≥n de datos de usuario
- **CORS configurado**: Control de acceso cross-origin
- **Rate limiting**: Protecci√≥n contra abuse (impl√≠cito)
- **Error handling**: No exposici√≥n de informaci√≥n sensible
- **Environment variables**: Configuraci√≥n externa de secretos

### üîí **Operaciones Protegidas**:
- Mantenimiento del sistema
- Ejecuci√≥n manual de scrapers
- Modificaci√≥n de base de conocimiento
- Acceso a logs detallados
- Configuraci√≥n de automatizaci√≥n

---

## üìà Monitoreo y M√©tricas

### üìä **M√©tricas Recolectadas**:
- **Conversaciones**: Total, por tipo de usuario, por periodo
- **Satisfacci√≥n**: Ratings promedio, distribuci√≥n de feedback
- **Performance**: Tiempos de respuesta, evidencia encontrada
- **Sistema**: Estado de BD, IA, scrapers, √∫ltima actualizaci√≥n
- **Contenido**: Registros en KB, cobertura por √°rea

### üîç **Monitoring Endpoints**:
- `GET /api/health` - Estado general del sistema
- `GET /api/admin/metrics` - M√©tricas detalladas
- `GET /api/admin/db-status` - Estado de base de datos
- `GET /api/admin/ai-status` - Estado del servicio IA

### üìã **Logging**:
- **Estructurado**: JSON con categor√≠as y timestamps
- **Rotaci√≥n autom√°tica**: Por fecha y tama√±o
- **Niveles**: ERROR, WARN, INFO, DEBUG
- **Categor√≠as**: CHAT, AI, DB, SYSTEM, AUTOMATION, SCRAPER

---

## üöÄ Deployment y DevOps

### üèóÔ∏è **Opciones de Despliegue**:

#### **Desarrollo Local**:
```bash
npm install
npm run dev  # Con hot-reload
```

#### **Producci√≥n Simple**:
```bash
npm ci --only=production
npm start
```

#### **Con PM2** (Recomendado):
```bash
npm install -g pm2
pm2 start src/server.js --name "chatbot-uts"
pm2 startup  # Autostart en boot
pm2 save     # Guardar configuraci√≥n
```

#### **Docker** (Opcional):
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3001
CMD ["npm", "start"]
```

### üîÑ **CI/CD Consideraciones**:
- **Testing**: `npm test` antes de deployment
- **Environment**: Variables de entorno por ambiente
- **Database**: Migrations autom√°ticas con `bootstrapSchema()`
- **Static files**: Servidos por Express (o nginx en producci√≥n)

---

## üõ†Ô∏è Mantenimiento

### üîß **Tareas Regulares**:
- **Actualizaci√≥n de contenido**: Autom√°tica via scrapers
- **Optimizaci√≥n de b√∫squeda**: Keywords y sin√≥nimos autom√°ticos
- **Monitoreo de logs**: Revisar errores y performance
- **Backup de BD**: Recomendado semanal
- **Actualizaci√≥n de dependencias**: Mensual

### üìÖ **Programaci√≥n Recomendada**:
- **Verificaci√≥n de cambios**: Cada 6 horas
- **Actualizaci√≥n completa**: Diario a las 2:00 AM
- **Actualizaci√≥n inteligente**: Cada 2 horas
- **Backup de base de datos**: Semanal
- **Revisi√≥n de logs**: Diario

### üö® **Troubleshooting Actualizado v1.3.0**:
- **Chat no responde**: Verificar API key de Gemini y conectividad
- **Sugerencias lentas**: ‚úÖ SOLUCIONADO - Sistema est√°tico instant√°neo implementado
- **B√∫squeda deficiente**: ‚úÖ OPTIMIZADO - Ejecutar `npm run improve-keywords` o ajustar filtros
- **Informaci√≥n no encontrada**: ‚úÖ SOLUCIONADO - Filtros optimizados, usar b√∫squeda web complementaria
- **Contenido desactualizado**: Ejecutar `npm run scrapers` (solo fuentes activas)
- **Performance lenta**: Revisar logs de timing y optimizar consultas
- **Errores de BD**: Verificar permisos de archivo SQLite o conexi√≥n PostgreSQL
- **"No teacher found" frecuente**: ‚úÖ COMPORTAMIENTO NORMAL - UTS elimin√≥ secci√≥n docentes
- **Scrapers sin resultados**: Verificar si las fuentes UTS siguen disponibles
- **B√∫squedas web no aparecen**: ‚úÖ NORMAL - Solo cuando evidenceCount === 0 y usuario no ha usado bot√≥n
- **Sugerencias no contextuales**: ‚úÖ SOLUCIONADO - Sistema est√°tico por categor√≠as implementado

---

## üìö Recursos y Referencias

### üîó **APIs y Servicios**:
- **Google Gemini AI**: https://ai.google.dev/
- **Fuse.js**: https://fusejs.io/
- **Cheerio**: https://cheerio.js.org/
- **Express.js**: https://expressjs.com/

### üìñ **Documentaci√≥n UTS - Estado de Fuentes**:
- **Sitio principal**: ‚úÖ https://www.uts.edu.co/
- **Programas acad√©micos**: ‚úÖ https://www.uts.edu.co/sitio/programas-academicos/
- **Aspirantes**: ‚úÖ https://www.uts.edu.co/sitio/aspirantes/
- **Estudiantes**: ‚úÖ https://www.uts.edu.co/sitio/estudiantes/
- **Docentes**: ‚ö†Ô∏è https://www.uts.edu.co/sitio/docentes/ (sin informaci√≥n espec√≠fica de profesores)

### üéØ **Espec√≠fico del Proyecto**:
- **Repositorio**: https://github.com/mandresjacome/chatbot-uts
- **Issues**: Para reportar bugs o solicitar features
- **Wiki**: Documentaci√≥n adicional y tutoriales

---

## ü§ù Contribuci√≥n y Desarrollo

### üîß **Setup de Desarrollo**:
```bash
git clone https://github.com/mandresjacome/chatbot-uts.git
cd chatbot-uts
npm install
cp .env.example .env  # Configurar variables
npm run dev           # Iniciar en modo desarrollo
```

### üìã **Convenciones**:
- **Commits**: Conventional commits (feat:, fix:, docs:)
- **Code style**: ESLint + Prettier
- **Testing**: Jest para unit tests
- **Documentation**: JSDoc para funciones principales

### üéØ **√Åreas de Mejora**:
- **Testing**: Ampliar cobertura de pruebas
- **Performance**: Optimizaci√≥n de consultas BD
- **Features**: M√°s tipos de contenido UTS
- **UI/UX**: Mejoras en interfaces
- **Analytics**: M√©tricas m√°s detalladas

---

## üìÑ Licencia y Cr√©ditos

**Licencia**: ISC License  
**Autor**: Mario Andr√©s J√°come Mantilla  
**Instituci√≥n**: Unidades Tecnol√≥gicas de Santander (UTS)  
**A√±o**: 2025

### üôè **Agradecimientos**:
- **UTS**: Por la oportunidad y el contenido
- **Google**: Por la API de Gemini AI
- **Comunidad Open Source**: Por las librer√≠as utilizadas

---

## üìû Contacto y Soporte

Para consultas sobre el sistema:
- **Email**: [mario.jacome@uts.edu.co]
- **GitHub**: [@mandresjacome]
- **Instituci√≥n**: Unidades Tecnol√≥gicas de Santander

---

*Documentaci√≥n actualizada autom√°ticamente el 25 de septiembre de 2025*  
*√öltima actualizaci√≥n: v1.3.0 - Sistema h√≠brido revolucionario con mejoras cr√≠ticas*  

---

### üéâ Resumen Ejecutivo - ESTADO REVOLUCIONADO v1.3.0

El **Chatbot UTS v1.3.0** es un sistema integral de asistencia virtual que ha sido **revolucionado** con mejoras cr√≠ticas:

‚úÖ **Sistema de Sugerencias Instant√°neas** - 0ms vs 2-3s anterior, sin APIs externas  
‚úÖ **B√∫squeda H√≠brida Inteligente** - BD local + web complementaria controlada por usuario  
‚úÖ **Filtros de Relevancia Optimizados** - Fix cr√≠tico para detectar informaci√≥n existente  
‚úÖ **Inteligencia Artificial contextual** para respuestas naturales y apropiadas  
‚úÖ **Automatizaci√≥n robusta** de mantenimiento de contenido con detecci√≥n de cambios  
‚úÖ **Interfaces m√∫ltiples** adaptadas a cada tipo de usuario con temas personalizados  
‚úÖ **Arquitectura escalable** con soporte para crecimiento y nuevas funcionalidades  
‚úÖ **Monitoreo integral** con m√©tricas, feedback continuo y logging estructurado  
‚úÖ **Manejo inteligente de limitaciones** - respuestas apropiadas cuando datos no disponibles  
‚úÖ **Sistema preparado para el futuro** - reactivaci√≥n autom√°tica si UTS restaura informaci√≥n faltante  
‚úÖ **Mantenimiento aut√≥nomo** con actualizaciones inteligentes solo cuando es necesario  

### üéØ Diferencial Clave v1.3.0 - Mejoras Revolucionarias
- **Performance Extrema**: Sugerencias de 2-3 segundos ‚Üí instant√°neas (0ms)
- **Confiabilidad Total**: Sin dependencias externas fr√°giles ‚Üí sistema est√°tico robusto  
- **Detecci√≥n Mejorada**: Informaci√≥n existente que no se encontraba ‚Üí ahora detectada correctamente
- **Control de Usuario**: B√∫squedas autom√°ticas invasivas ‚Üí control total del usuario
- **Simplicidad Inteligente**: Sistema complejo con bugs ‚Üí l√≥gica simple y robusta

### ‚ö†Ô∏è Limitaci√≥n Actual Documentada
**Informaci√≥n de Docentes**: UTS elimin√≥ la secci√≥n de profesores del sitio oficial. El sistema detecta estas b√∫squedas y responde de forma √∫til ofreciendo alternativas de contacto + bot√≥n de b√∫squeda web opcional.

El sistema v1.3.0 est√° dise√±ado para **funcionar de manera aut√≥noma, ultra-r√°pida y resiliente**, manteni√©ndose actualizado autom√°ticamente con el contenido disponible de la UTS, adapt√°ndose a cambios en las fuentes oficiales, y proporcionando asistencia 24/7 instant√°nea y honesta a estudiantes, docentes y aspirantes.

---

**üè´ Proyecto revolucionado para la Universidad Tecnol√≥gica de Santander**  
**üë®‚Äçüíª Mario Andr√©s J√°come Mantilla - Ingenier√≠a de Sistemas**  
**üöÄ v1.3.0 - Performance y UX revolucionarios implementados**
