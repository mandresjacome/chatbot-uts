# üìã Documentaci√≥n Completa del Proyecto Chatbot UTS

## üéØ Informaci√≥n General del Proyecto

**Nombre**: Chatbot UTS v1.3.0  
**Prop√≥sito**: Chatbot inteligente especializado en **Ingenier√≠a de Sistemas** de las Unidades Tecnol√≥gicas de Santander (UTS)  
**Desarrollador**: Mario Andr√©s J√°come Mantilla  
**Repositorio**: https://github.com/mandresjacome/chatbot-uts  
**Tecnolog√≠as**: Node.js, Express, SQLite/PostgreSQL, Google Gemini AI, Scrapers Web  
**Estado**: Completamente funcional con limitaciones documentadas

### üöÄ Caracter√≠sticas Principales - ESTADO ACTUAL (Septiembre 2025)
- ‚úÖ **Chat inteligente especializado** en el programa de Ingenier√≠a de Sistemas UTS
- ‚úÖ **Informaci√≥n actualizada** mediante scrapers autom√°ticos desde la web oficial UTS
- ‚úÖ **Malla curricular interactiva** con navegaci√≥n completa por semestres y materias
- ‚úÖ **Sistema de scrapers robustos** que mantiene sincronizaci√≥n con fuentes oficiales
- ‚úÖ **Detecci√≥n inteligente de consultas** (malla, informaci√≥n general, programas)
- ‚úÖ **Integraci√≥n con Gemini AI** para respuestas contextuales y naturales
- ‚úÖ **Base de datos dual** SQLite (desarrollo) / PostgreSQL (producci√≥n)
- ‚úÖ **Panel de administraci√≥n** completo con m√©tricas y gesti√≥n de contenido
- ‚úÖ **Sistema de feedback** para mejora continua de la calidad
- ‚úÖ **API REST completa** con endpoints especializados
- ‚úÖ **Logging avanzado** con diferentes niveles y archivos por fecha
- ‚úÖ **Respuestas apropiadas** cuando informaci√≥n no est√° disponible
- ‚ö†Ô∏è **Informaci√≥n de docentes**: NO DISPONIBLE (UTS elimin√≥ la secci√≥n de profesores)
- ‚úÖ **Manejo inteligente**: Detecta b√∫squedas de docentes y responde apropiadamente

---

## üìÅ Estructura Detallada del Proyecto

### üóÇÔ∏è Directorio Ra√≠z
```
chatbot-uts/
‚îú‚îÄ‚îÄ package.json              # Configuraci√≥n del proyecto Node.js
‚îú‚îÄ‚îÄ jest.config.json          # Configuraci√≥n de pruebas con Jest
‚îú‚îÄ‚îÄ README.md                 # Documentaci√≥n principal del proyecto
‚îú‚îÄ‚îÄ backup-test.db            # Backup de prueba de la base de datos
‚îú‚îÄ‚îÄ DOCUMENTACION_COMPLETA.md # Este archivo de documentaci√≥n
```

### üìÇ `/src` - C√≥digo Fuente Principal

#### üåê **`server.js`** - Servidor Principal
- **Funci√≥n**: Punto de entrada de la aplicaci√≥n
- **Caracter√≠sticas**:
  - Configuraci√≥n de Express.js con middlewares
  - Inicializaci√≥n de base de datos autom√°tica
  - Configuraci√≥n de CORS para peticiones cross-origin
  - Endpoints de salud y m√©tricas p√∫blicas
  - Rutas est√°ticas para archivos p√∫blicos
  - Sistema de logging integrado
  - Autenticaci√≥n admin para mantenimiento

#### üõ£Ô∏è **`/routes`** - Rutas de la API

##### **`chat.js`** - Endpoint Principal del Chatbot
- **Funci√≥n**: Maneja las conversaciones del chatbot
- **Endpoint**: `POST /api/chat/message`
- **Proceso**:
  1. Validaci√≥n de entrada (mensaje, tipo de usuario, sessionId)
  2. B√∫squeda de evidencia en base de conocimiento con retriever
  3. Generaci√≥n de respuesta con IA (Gemini)
  4. Persistencia de conversaci√≥n en base de datos
  5. Retorno de respuesta con referencias y metadatos
- **M√©tricas**: Tiempo de respuesta, evidencia encontrada, modelo usado

##### **`feedback.js`** - Sistema de Retroalimentaci√≥n
- **Funci√≥n**: Recopilar y almacenar feedback de usuarios
- **Endpoint**: `POST /api/feedback`
- **Datos**: rating (1-5), comentarios, sessionId, conversationId

##### **`admin.js`** - Rutas de Administraci√≥n
- **Funci√≥n**: Operaciones de mantenimiento protegidas
- **Autenticaci√≥n**: Middleware adminAuth con token
- **Operaciones**: Gesti√≥n de base de conocimiento, mantenimiento del sistema

#### üß† **`/ai`** - Integraci√≥n con Inteligencia Artificial

##### **`geminiClient.js`** - Cliente de Google Gemini
- **Funci√≥n**: Interfaz con la API de Google Gemini
- **Estado**: ‚úÖ TOTALMENTE FUNCIONAL CON MEJORAS
- **Caracter√≠sticas actuales**:
  - Soporte para m√∫ltiples modelos (gemini-2.5-flash por defecto)
  - Sistema de prompts optimizado "evidencia primero"
  - **Detecci√≥n inteligente de consultas de docentes**
  - **Manejo especializado cuando no hay datos de profesores**
  - Fallback a modo mock sin API key
  - Control de longitud de respuesta y evidencia
  - Manejo de errores y reintentos
- **Mejora clave**: Respuestas apropiadas para datos no disponibles
- **Ejemplo respuesta docentes**: "No encontr√© informaci√≥n espec√≠fica del docente, te sugiero contactar coordinaci√≥n acad√©mica"

#### üóÑÔ∏è **`/db`** - Capa de Base de Datos

##### **`index.js`** - Abstracci√≥n de Base de Datos
- **Funci√≥n**: Capa de abstracci√≥n para SQLite/PostgreSQL
- **Caracter√≠sticas**:
  - Conexi√≥n autom√°tica seg√∫n variables de entorno
  - Bootstrap autom√°tico del esquema
  - Funciones de consulta unificadas
  - Manejo de transacciones

##### **`repositories.js`** - Repositorios de Datos
- **Funci√≥n**: Operaciones CRUD especializadas
- **Repositorios**:
  - `Conversations`: Gesti√≥n de conversaciones del chat
  - `Feedback`: Almacenamiento de valoraciones
  - `KnowledgeBase`: Base de conocimiento UTS

##### **`database.js`** - Adaptador de Compatibilidad
- **Funci√≥n**: Compatibilidad con scrapers CJS existentes
- **Caracter√≠sticas**: Traduce placeholders entre SQLite y PostgreSQL

#### üß† **`/nlp`** - Procesamiento de Lenguaje Natural

##### **`retriever.js`** - Sistema de Recuperaci√≥n
- **Funci√≥n**: B√∫squeda inteligente en base de conocimiento
- **Estado**: ‚úÖ TOTALMENTE FUNCIONAL
- **Tecnolog√≠as**:
  - **Fuse.js**: B√∫squeda difusa tolerante a errores
  - **compromise**: An√°lisis de entidades y fechas
  - **Sin√≥nimos**: Expansi√≥n autom√°tica de consultas
- **Configuraci√≥n**: Pesos ajustados (palabras clave 50%, pregunta 30%, contenido 20%)
- **Filtros**: Por tipo de usuario (aspirante, estudiante, docente, todos)

##### **`teacherSearch.js`** - B√∫squeda de Docentes
- **Funci√≥n**: Detecci√≥n especializada de consultas sobre profesores
- **Estado**: ‚úÖ FUNCIONAL (detecta consultas, responde apropiadamente)
- **Comportamiento actual**:
  - Detecta b√∫squedas de profesores con alta precisi√≥n
  - No retorna datos espec√≠ficos (fuente no disponible)
  - Proporciona respuesta √∫til con alternativas de contacto
- **Conservado**: Sistema preparado para reactivaci√≥n si UTS restaura informaci√≥n

##### **`synonyms.js`** - Sin√≥nimos Generados
- **Funci√≥n**: Sin√≥nimos espec√≠ficos para mejorar b√∫squedas
- **Estado**: ‚úÖ ACTIVO Y ACTUALIZADO
- **Generaci√≥n**: Autom√°tica basada en an√°lisis de contenido UTS disponible
- **Categor√≠as**: 21+ grupos de sin√≥nimos espec√≠ficos por dominio
- **Actualizaci√≥n**: Regeneraci√≥n autom√°tica con cambios de contenido
- **Nota**: Ya no incluye sin√≥nimos de nombres de profesores espec√≠ficos

##### **`kbLoader.js`** - Cargador de Base de Conocimiento
- **Funci√≥n**: Carga y sincronizaci√≥n de KB desde base de datos
- **Estado**: ‚úÖ COMPLETAMENTE FUNCIONAL
- **Caracter√≠sticas**: Procesamiento de texto para b√∫squeda optimizada
- **Filtra**: Autom√°ticamente contenido obsoleto o sin datos

#### üõ†Ô∏è **`/utils`** - Utilidades del Sistema

##### **`logger.js`** - Sistema de Logging
- **Funci√≥n**: Logging estructurado del sistema
- **Caracter√≠sticas**:
  - Logs categorizados (CHAT, AI, DB, SYSTEM, etc.)
  - Timestamps autom√°ticos
  - Diferentes niveles de log
  - Formato legible y parseable

##### **`normalize.js`** - Normalizaci√≥n de Texto
- **Funci√≥n**: Limpieza y normalizaci√≥n de consultas
- **Caracter√≠sticas**: Eliminaci√≥n de acentos, espacios, caracteres especiales

##### **`id.js`** - Generaci√≥n de Identificadores
- **Funci√≥n**: Generaci√≥n de sessionIds √∫nicos para conversaciones

##### **`database-adapter.cjs`** - Adaptador CJS
- **Funci√≥n**: Compatibilidad con scrapers CommonJS existentes

#### üîê **`/middlewares`** - Middlewares de Express

##### **`adminAuth.js`** - Autenticaci√≥n de Administrador
- **Funci√≥n**: Protecci√≥n de rutas de mantenimiento
- **M√©todo**: Token-based authentication
- **Variable**: `ADMIN_TOKEN` environment variable

#### üìä **`/data`** - Datos del Sistema

##### **`knowledge.json`** - Base de Conocimiento Legacy
- **Funci√≥n**: Base de conocimiento inicial (migrada a SQLite)
- **Estado**: Mantenida para compatibilidad

### üìÇ `/public` - Archivos P√∫blicos e Interfaces

#### üé® **P√°gina Principal** (`index.html`)
- **Funci√≥n**: Demostraci√≥n del widget flotante
- **Caracter√≠sticas**: Widget embebido, m√∫ltiples temas, responsive

#### üí¨ **`/chat`** - Interfaz de Chat Directo
- **Archivos**:
  - `index.html`: P√°gina principal del chat
  - `chat.css`: Estilos del chat
  - `chat.js`: L√≥gica del chat
  - `widget.js`: Widget embebible
  - `modal-user.js/.css`: Modal para selecci√≥n de perfil
- **Temas**: 4 temas visuales (aspirante, estudiante, docente, visitante)

#### üîß **`/admin`** - Panel de Administraci√≥n
- **Funci√≥n**: Interface web completa para administradores
- **Secciones**:
  1. **M√©tricas**: Conversaciones totales, satisfacci√≥n, √∫ltimas interacciones
  2. **Feedback**: An√°lisis de valoraciones de usuarios
  3. **Base de Conocimiento**: Exploraci√≥n y verificaci√≥n de fuentes
  4. **Mantenimiento**: Operaciones del sistema (protegidas)

##### **Archivos del Admin Panel**:
- `index.html`: P√°gina principal con navegaci√≥n por tabs
- **CSS Modular**:
  - `css/base.css`: Estilos base y tema
  - `css/metrics.css`: Estilos para m√©tricas
  - `css/feedback.css`: Estilos para feedback
  - `css/knowledge.css`: Estilos para base de conocimiento
  - `css/maintenance.css`: Estilos para mantenimiento
- **JavaScript Modular**:
  - `js/metrics.js`: L√≥gica de m√©tricas
  - `js/feedback.js`: L√≥gica de feedback
  - `js/knowledge.js`: L√≥gica de base de conocimiento
  - `js/maintenance.js`: L√≥gica de mantenimiento

#### üñºÔ∏è **Recursos Visuales**
- **GIFs Animados**: 5 avatares del chatbot por tipo de usuario
- **logoUTS.webp**: Logo oficial de la UTS
- **Temas CSS**: Colores espec√≠ficos por perfil de usuario

### üìÇ `/scripts` - Scripts de Automatizaci√≥n

#### ü§ñ **`auto-update-system.cjs`** - Sistema Principal de Automatizaci√≥n
- **Funci√≥n**: Orquestador principal del sistema de actualizaci√≥n
- **Estado**: ‚úÖ ACTIVO
- **Operaciones**:
  - `fullUpdate()`: Actualizaci√≥n completa (scrapers + keywords + sin√≥nimos)
  - `quickUpdate()`: Actualizaci√≥n r√°pida (solo optimizaci√≥n)
  - `checkContent()`: Verificaci√≥n de nuevo contenido
- **Reportes**: M√©tricas detalladas de cada operaci√≥n

#### üîç **`change-detector.cjs`** - Detector de Cambios
- **Funci√≥n**: Monitoreo autom√°tico de cambios en p√°ginas UTS
- **Estado**: ‚úÖ ACTIVO
- **Caracter√≠sticas**:
  - Cache de snapshots anteriores
  - Detecci√≥n granular de modificaciones
  - Triggers autom√°ticos de actualizaci√≥n
  - Sistema de umbral para evitar false positives

#### üéØ **`improve-keywords.cjs`** - Optimizador de Palabras Clave
- **Funci√≥n**: Mejora autom√°tica de keywords para b√∫squeda
- **Estado**: ‚úÖ ACTIVO
- **Algoritmo**: An√°lisis de frecuencia y relevancia
- **Actualizaci√≥n**: Modificaci√≥n directa en base de datos

#### üìù **`generate-synonyms.cjs`** - Generador de Sin√≥nimos
- **Funci√≥n**: Creaci√≥n autom√°tica de sin√≥nimos espec√≠ficos UTS
- **Estado**: ‚úÖ ACTIVO
- **M√©todo**: An√°lisis del corpus de conocimiento
- **Salida**: Archivo `synonyms.js` actualizado

#### üï∑Ô∏è **`run-scrapers.cjs`** - Ejecutor de Scrapers
- **Funci√≥n**: Coordinaci√≥n de todos los scrapers web
- **Estado**: ‚úÖ ACTIVO
- **Scrapers incluidos**: aspirantes, estudiantes, tecnolog√≠a, fixed
- **Scraper obsoleto**: docentes (conservado por compatibilidad)

#### üîÑ **`sync-teacher-keywords.cjs`** - Sincronizador de Docentes
- **Funci√≥n**: Sincronizaci√≥n de informaci√≥n de profesores
- **Estado**: ‚ö†Ô∏è OBSOLETO (conservado por compatibilidad)
- **Raz√≥n**: UTS elimin√≥ la secci√≥n de informaci√≥n de docentes

#### ‚öôÔ∏è **Scripts de Configuraci√≥n Autom√°tica**
- **`setup-automation-windows.bat`**: Configuraci√≥n de Task Scheduler (Windows)
- **`setup-automation-unix.sh`**: Configuraci√≥n de Cron Jobs (Linux/Mac)
- **`deploy-init.cjs`**: ‚úÖ Script de inicializaci√≥n para deploy
- **`setup-teacher-sync.cjs`**: ‚ö†Ô∏è OBSOLETO (configuraci√≥n para sincronizaci√≥n de docentes)

### üìÇ `/scrapers` - Extractores de Contenido Web

#### üéØ **Scrapers Especializados - ESTADO ACTUAL**:
- **`scraper_aspirantes.cjs`**: ‚úÖ ACTIVO - Informaci√≥n para futuros estudiantes
- **`scraper_estudiantes.cjs`**: ‚úÖ ACTIVO - Servicios y tr√°mites estudiantiles
- **`scraper_tecnologia.cjs`**: ‚úÖ ACTIVO - Programas tecnol√≥gicos espec√≠ficos
- **`scraper_fixed.cjs`**: ‚úÖ ACTIVO - Informaci√≥n general y est√°tica
- **`scraper_docentes.cjs`**: ‚ö†Ô∏è OBSOLETO - Recursos y procedimientos para docentes (conservado por compatibilidad)

#### ‚ö†Ô∏è **Importante - Scraper de Docentes**:
- **Estado**: No funcional desde septiembre 2024
- **Raz√≥n**: UTS elimin√≥ la secci√≥n de informaci√≥n de profesores del sitio web oficial
- **Comportamiento**: El script se ejecuta pero no encuentra contenido para extraer
- **Conservaci√≥n**: Se mantiene el archivo para compatibilidad y posible reactivaci√≥n futura

#### üîß **Caracter√≠sticas de los Scrapers Activos**:
- **Robustez**: Manejo de errores de red y parsing
- **Selectores inteligentes**: Adaptaci√≥n a cambios menores en HTML
- **Categorizaci√≥n autom√°tica**: Asignaci√≥n de tipo de usuario
- **Procesamiento de texto**: Limpieza y estructuraci√≥n de contenido
- **Cache de resultados**: Evita re-procesamiento innecesario
- **Detecci√≥n de cambios**: Solo actualiza cuando hay modificaciones reales

### üìÇ `/tests` - Suite de Pruebas

#### üß™ **`chat.test.js`** - Pruebas de la API de Chat
- **Framework**: Jest + Supertest
- **Cobertura**:
  - Validaci√≥n de entrada (mensajes vac√≠os)
  - Modo mock vs. modo real
  - Manejo de evidencia
  - Respuestas de fallback
- **Configuraci√≥n**: `jest.config.json` con soporte ES modules

### üìÇ `/cache` - Cache del Sistema

#### üíæ **Archivos de Cache**:
- **`database.json`**: Estado anterior de la base de datos
- **`web_*.json`**: Snapshots de p√°ginas web monitoreadas
- **`detection_report.json`**: √öltimo reporte de detecci√≥n de cambios

### üìÇ `/logs` - Sistema de Logging

#### üìã **Archivos de Log**:
- **`chatbot-YYYY-MM-DD.log`**: Logs diarios del chatbot
- **`automation.log`**: Logs espec√≠ficos de automatizaci√≥n (Unix)

### üìÇ `/config` - Configuraci√≥n del Sistema

#### ‚öôÔ∏è **`automation.json`** - Configuraci√≥n de Automatizaci√≥n
- **Secciones**:
  - `automation`: Habilitaci√≥n y modo del sistema
  - `schedules`: Frecuencias de ejecuci√≥n (cron format)
  - `monitoring`: URLs monitoreadas y timeouts
  - `updates`: Configuraci√≥n de actualizaciones autom√°ticas
  - `performance`: L√≠mites de recursos del sistema
  - `logging`: Configuraci√≥n avanzada de logs

---

## üîß Configuraci√≥n y Funcionamiento

### üåç Variables de Entorno

```bash
# Obligatorias
GEMINI_API_KEY=tu_api_key_de_google_gemini  # Clave API de Google Gemini

# Opcionales con valores por defecto
PORT=3001                    # Puerto del servidor
NODE_ENV=development         # Entorno de ejecuci√≥n
USE_LLM=gemini              # Modo de IA (gemini/mock)
GEMINI_MODEL=gemini-2.5-flash # Modelo espec√≠fico de Gemini
ADMIN_TOKEN=admin123        # Token para operaciones de admin

# Base de datos (autom√°tica)
DATABASE_URL=               # PostgreSQL URL (si no se define, usa SQLite)
DB_SQLITE_PATH=./src/db/database.db  # Ruta de SQLite por defecto

# L√≠mites del sistema
MAX_CHARS_EVIDENCE=2500     # M√°ximo caracteres de evidencia para IA
MAX_CHARS_RESPONSE=1200     # M√°ximo caracteres de respuesta
```

### üöÄ Scripts de Package.json

```bash
# Desarrollo
npm run dev                 # Servidor con nodemon (hot-reload)
npm start                   # Servidor de producci√≥n

# Testing
npm test                    # Ejecutar pruebas con Jest

# Scrapers individuales
npm run scraper:aspirantes  # Scraper de aspirantes
npm run scraper:docentes    # Scraper de docentes
npm run scraper:estudiantes # Scraper de estudiantes
npm run scraper:tecnologia  # Scraper de tecnolog√≠a
npm run scraper:fixed       # Scraper de informaci√≥n general
npm run scrapers            # Todos los scrapers

# Optimizaci√≥n del sistema
npm run improve-keywords    # Mejorar palabras clave
npm run generate-synonyms   # Generar sin√≥nimos autom√°ticos

# Automatizaci√≥n
npm run auto-update         # Actualizaci√≥n completa del sistema
npm run auto-update-quick   # Actualizaci√≥n r√°pida (sin scrapers)
npm run detect-changes      # Detectar cambios en p√°ginas web
npm run auto-check-update   # Actualizar solo si hay cambios

# Configuraci√≥n
npm run setup-automation    # Informaci√≥n para configurar tareas autom√°ticas
```

---

## ÔøΩ Estado Actual del Sistema - IMPORTANTE (Septiembre 2025)

### ‚úÖ Componentes Completamente Funcionales
- **Web Scraping**: Extrae informaci√≥n actualizada de UTS (4 de 5 scrapers activos)
- **Chat con IA**: Gemini integrado con respuestas contextuales inteligentes
- **Malla Curricular**: Navegaci√≥n completa con prerrequisitos y conexiones
- **Panel Admin**: Gesti√≥n completa del sistema con m√©tricas en tiempo real
- **Base de Conocimiento**: Actualizaci√≥n autom√°tica con sin√≥nimos inteligentes
- **Logging**: Sistema robusto de trazabilidad con rotaci√≥n autom√°tica
- **Detecci√≥n de Consultas**: Reconoce b√∫squedas de docentes y responde apropiadamente

### ‚ö†Ô∏è Limitaci√≥n Conocida - Informaci√≥n de Docentes
- **Situaci√≥n**: UTS elimin√≥ la secci√≥n de informaci√≥n de profesores del sitio oficial
- **Impacto**: No hay datos espec√≠ficos de docentes disponibles para extracci√≥n
- **Comportamiento del Sistema**: 
  - ‚úÖ Detecta correctamente b√∫squedas de profesores
  - ‚úÖ Responde de forma √∫til informando la limitaci√≥n
  - ‚úÖ Ofrece alternativas de contacto (coordinaci√≥n acad√©mica)
  - ‚úÖ No genera errores ni respuestas confusas

### ÔøΩüîÑ Componentes Obsoletos (Conservados por Compatibilidad)
- **`scraper_docentes.cjs`**: No extrae datos (fuente eliminada por UTS)
- **`sync-teacher-keywords.cjs`**: No sincroniza nombres (sin datos fuente)
- **Cache de docentes**: Contiene datos hist√≥ricos de septiembre 2024

### üéØ Respuesta Actual para B√∫squedas de Docentes
```
‚ùå No encontr√© informaci√≥n del docente "[nombre]" en los datos disponibles 
   del programa de Ingenier√≠a de Sistemas.

üí° Te puedo ayudar con:
- üìã Informaci√≥n general del programa  
- üéì Malla curricular y materias
- üìû Contacto de coordinaci√≥n acad√©mica
- üèõÔ∏è Requisitos de admisi√≥n

üìû Para informaci√≥n espec√≠fica de docentes, contacta:
   - Coordinaci√≥n de Ingenier√≠a de Sistemas
   - Tel√©fono: Disponible en el sitio oficial UTS
```

### üöÄ Sistema Preparado para el Futuro
Si UTS restaura la informaci√≥n de docentes:
1. ‚úÖ `scraper_docentes.cjs` reactivable inmediatamente
2. ‚úÖ `teacherSearch.js` mantiene toda la l√≥gica de detecci√≥n
3. ‚úÖ `sync-teacher-keywords.cjs` listo para sincronizaci√≥n
4. ‚úÖ Base de conocimiento expandible autom√°ticamente
5. ‚úÖ Sin cambios necesarios en c√≥digo principal

## üîÑ Flujo de Funcionamiento Actual

### üí¨ **Proceso de Chat Mejorado**
1. **Usuario env√≠a mensaje** ‚Üí `POST /api/chat/message`
2. **Validaci√≥n de entrada** ‚Üí sessionId, userType, message
3. **Detecci√≥n especializada** ‚Üí Identifica si busca docentes, malla curricular, etc.
4. **B√∫squeda de evidencia** ‚Üí Fuse.js en base de conocimiento activa
5. **Expansi√≥n con sin√≥nimos** ‚Üí Mejora la b√∫squeda con t√©rminos relacionados
6. **Filtro por tipo de usuario** ‚Üí aspirante/estudiante/docente/todos
7. **Procesamiento inteligente en IA**:
   - Si busca docentes ‚Üí Respuesta espec√≠fica sobre limitaci√≥n + alternativas
   - Si busca otros temas ‚Üí Respuesta con evidencia encontrada
8. **Persistencia en BD** ‚Üí Conversaci√≥n guardada para m√©tricas
9. **Respuesta al usuario** ‚Üí JSON con respuesta contextual y metadatos

### üï∑Ô∏è **Proceso de Scraping Actualizado**
1. **Ejecuci√≥n programada/manual** ‚Üí Scripts de scraping coordinados
2. **Verificaci√≥n de fuentes** ‚Üí Check de disponibilidad de cada URL UTS
3. **Descarga selectiva** ‚Üí Solo p√°ginas con contenido disponible:
   - ‚úÖ Aspirantes, Estudiantes, Tecnolog√≠a, Informaci√≥n General
   - ‚ö†Ô∏è Docentes: Se ejecuta pero no encuentra contenido v√°lido
4. **Extracci√≥n de contenido** ‚Üí Cheerio + selectores CSS optimizados
5. **Procesamiento de texto** ‚Üí Limpieza y estructuraci√≥n inteligente
6. **Categorizaci√≥n autom√°tica** ‚Üí Asignaci√≥n de tipo de usuario
7. **Validaci√≥n de contenido** ‚Üí Descarta datos vac√≠os o inv√°lidos
8. **Almacenamiento en BD** ‚Üí Insert/Update solo con contenido v√°lido
9. **Generaci√≥n de keywords** ‚Üí An√°lisis autom√°tico de relevancia
10. **Actualizaci√≥n de sin√≥nimos** ‚Üí Regeneraci√≥n basada en contenido real

### ü§ñ **Proceso de Automatizaci√≥n Inteligente**
1. **Detecci√≥n de cambios** ‚Üí Comparaci√≥n con cache anterior por URL
2. **Filtro inteligente** ‚Üí Ignora p√°ginas sin contenido v√°lido (ej: docentes)
3. **Trigger condicional** ‚Üí Solo actualiza si hay cambios reales
4. **Ejecuci√≥n selectiva de scrapers** ‚Üí Solo ejecuta scrapers con fuentes activas
5. **Optimizaci√≥n autom√°tica** ‚Üí Keywords y sin√≥nimos basados en contenido real
6. **Validaci√≥n de BD** ‚Üí Verificaci√≥n de integridad y limpieza de datos obsoletos
7. **Recarga del sistema** ‚Üí Retriever y cache actualizado con datos v√°lidos
8. **Generaci√≥n de reportes** ‚Üí M√©tricas detalladas incluyendo limitaciones conocidas

---

## üìä Arquitectura del Sistema

### üèóÔ∏è **Patr√≥n Arquitect√≥nico**: MVC + Microservicios
- **Model**: Repositorios de datos (`/db/repositories.js`)
- **View**: Interfaces web (`/public/*`)
- **Controller**: Rutas y l√≥gica de negocio (`/routes/*`)
- **Services**: NLP, AI, Scrapers como servicios independientes

### üß© **Componentes Principales**:

#### üåê **API Layer**
- Express.js con middlewares
- CORS configurado para desarrollo
- Autenticaci√≥n basada en tokens
- Rate limiting impl√≠cito

#### üß† **Intelligence Layer**
- **Retriever**: B√∫squeda sem√°ntica con Fuse.js
- **AI Client**: Integraci√≥n con Google Gemini
- **NLP**: Procesamiento con compromise
- **Synonyms**: Expansi√≥n autom√°tica de consultas

#### üóÑÔ∏è **Data Layer**
- **SQLite**: Base de datos principal (desarrollo)
- **PostgreSQL**: Soporte para producci√≥n
- **Abstraction**: Capa unificada para ambas BD
- **Migrations**: Bootstrap autom√°tico de esquema

#### üï∑Ô∏è **Scraping Layer**
- **Scrapers especializados**: Por tipo de contenido UTS
- **Change Detection**: Monitoreo autom√°tico de modificaciones
- **Content Processing**: Limpieza y estructuraci√≥n de datos
- **Batch Processing**: Ejecuci√≥n coordinada de m√∫ltiples scrapers

#### ü§ñ **Automation Layer**
- **Smart Updates**: Actualizaciones solo cuando es necesario
- **Scheduled Tasks**: Tareas programadas del SO
- **Performance Monitoring**: M√©tricas de recursos y tiempo
- **Error Recovery**: Manejo robusto de fallos

---

## üîê Seguridad

### üõ°Ô∏è **Medidas Implementadas**:
- **Autenticaci√≥n**: Token-based para operaciones admin
- **Validaci√≥n de entrada**: Sanitizaci√≥n de datos de usuario
- **CORS configurado**: Control de acceso cross-origin
- **Rate limiting**: Protecci√≥n contra abuse (impl√≠cito)
- **Error handling**: No exposici√≥n de informaci√≥n sensible
- **Environment variables**: Configuraci√≥n externa de secretos

### üîí **Operaciones Protegidas**:
- Mantenimiento del sistema
- Ejecuci√≥n manual de scrapers
- Modificaci√≥n de base de conocimiento
- Acceso a logs detallados
- Configuraci√≥n de automatizaci√≥n

---

## üìà Monitoreo y M√©tricas

### üìä **M√©tricas Recolectadas**:
- **Conversaciones**: Total, por tipo de usuario, por periodo
- **Satisfacci√≥n**: Ratings promedio, distribuci√≥n de feedback
- **Performance**: Tiempos de respuesta, evidencia encontrada
- **Sistema**: Estado de BD, IA, scrapers, √∫ltima actualizaci√≥n
- **Contenido**: Registros en KB, cobertura por √°rea

### üîç **Monitoring Endpoints**:
- `GET /api/health` - Estado general del sistema
- `GET /api/admin/metrics` - M√©tricas detalladas
- `GET /api/admin/db-status` - Estado de base de datos
- `GET /api/admin/ai-status` - Estado del servicio IA

### üìã **Logging**:
- **Estructurado**: JSON con categor√≠as y timestamps
- **Rotaci√≥n autom√°tica**: Por fecha y tama√±o
- **Niveles**: ERROR, WARN, INFO, DEBUG
- **Categor√≠as**: CHAT, AI, DB, SYSTEM, AUTOMATION, SCRAPER

---

## üöÄ Deployment y DevOps

### üèóÔ∏è **Opciones de Despliegue**:

#### **Desarrollo Local**:
```bash
npm install
npm run dev  # Con hot-reload
```

#### **Producci√≥n Simple**:
```bash
npm ci --only=production
npm start
```

#### **Con PM2** (Recomendado):
```bash
npm install -g pm2
pm2 start src/server.js --name "chatbot-uts"
pm2 startup  # Autostart en boot
pm2 save     # Guardar configuraci√≥n
```

#### **Docker** (Opcional):
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3001
CMD ["npm", "start"]
```

### üîÑ **CI/CD Consideraciones**:
- **Testing**: `npm test` antes de deployment
- **Environment**: Variables de entorno por ambiente
- **Database**: Migrations autom√°ticas con `bootstrapSchema()`
- **Static files**: Servidos por Express (o nginx en producci√≥n)

---

## üõ†Ô∏è Mantenimiento

### üîß **Tareas Regulares**:
- **Actualizaci√≥n de contenido**: Autom√°tica via scrapers
- **Optimizaci√≥n de b√∫squeda**: Keywords y sin√≥nimos autom√°ticos
- **Monitoreo de logs**: Revisar errores y performance
- **Backup de BD**: Recomendado semanal
- **Actualizaci√≥n de dependencias**: Mensual

### üìÖ **Programaci√≥n Recomendada**:
- **Verificaci√≥n de cambios**: Cada 6 horas
- **Actualizaci√≥n completa**: Diario a las 2:00 AM
- **Actualizaci√≥n inteligente**: Cada 2 horas
- **Backup de base de datos**: Semanal
- **Revisi√≥n de logs**: Diario

### üö® **Troubleshooting Actualizado**:
- **Chat no responde**: Verificar API key de Gemini y conectividad
- **B√∫squeda deficiente**: Ejecutar `npm run improve-keywords`
- **Contenido desactualizado**: Ejecutar `npm run scrapers` (solo fuentes activas)
- **Performance lenta**: Revisar logs de timing y optimizar consultas
- **Errores de BD**: Verificar permisos de archivo SQLite o conexi√≥n PostgreSQL
- **"No teacher found" frecuente**: ‚úÖ COMPORTAMIENTO NORMAL - UTS elimin√≥ secci√≥n docentes
- **Scrapers sin resultados**: Verificar si las fuentes UTS siguen disponibles

---

## üìö Recursos y Referencias

### üîó **APIs y Servicios**:
- **Google Gemini AI**: https://ai.google.dev/
- **Fuse.js**: https://fusejs.io/
- **Cheerio**: https://cheerio.js.org/
- **Express.js**: https://expressjs.com/

### üìñ **Documentaci√≥n UTS - Estado de Fuentes**:
- **Sitio principal**: ‚úÖ https://www.uts.edu.co/
- **Programas acad√©micos**: ‚úÖ https://www.uts.edu.co/sitio/programas-academicos/
- **Aspirantes**: ‚úÖ https://www.uts.edu.co/sitio/aspirantes/
- **Estudiantes**: ‚úÖ https://www.uts.edu.co/sitio/estudiantes/
- **Docentes**: ‚ö†Ô∏è https://www.uts.edu.co/sitio/docentes/ (sin informaci√≥n espec√≠fica de profesores)

### üéØ **Espec√≠fico del Proyecto**:
- **Repositorio**: https://github.com/mandresjacome/chatbot-uts
- **Issues**: Para reportar bugs o solicitar features
- **Wiki**: Documentaci√≥n adicional y tutoriales

---

## ü§ù Contribuci√≥n y Desarrollo

### üîß **Setup de Desarrollo**:
```bash
git clone https://github.com/mandresjacome/chatbot-uts.git
cd chatbot-uts
npm install
cp .env.example .env  # Configurar variables
npm run dev           # Iniciar en modo desarrollo
```

### üìã **Convenciones**:
- **Commits**: Conventional commits (feat:, fix:, docs:)
- **Code style**: ESLint + Prettier
- **Testing**: Jest para unit tests
- **Documentation**: JSDoc para funciones principales

### üéØ **√Åreas de Mejora**:
- **Testing**: Ampliar cobertura de pruebas
- **Performance**: Optimizaci√≥n de consultas BD
- **Features**: M√°s tipos de contenido UTS
- **UI/UX**: Mejoras en interfaces
- **Analytics**: M√©tricas m√°s detalladas

---

## üìÑ Licencia y Cr√©ditos

**Licencia**: ISC License  
**Autor**: Mario Andr√©s J√°come Mantilla  
**Instituci√≥n**: Unidades Tecnol√≥gicas de Santander (UTS)  
**A√±o**: 2025

### üôè **Agradecimientos**:
- **UTS**: Por la oportunidad y el contenido
- **Google**: Por la API de Gemini AI
- **Comunidad Open Source**: Por las librer√≠as utilizadas

---

## üìû Contacto y Soporte

Para consultas sobre el sistema:
- **Email**: [mario.jacome@uts.edu.co]
- **GitHub**: [@mandresjacome]
- **Instituci√≥n**: Unidades Tecnol√≥gicas de Santander

---

*Documentaci√≥n actualizada autom√°ticamente el 25 de septiembre de 2025*  
*√öltima actualizaci√≥n: v1.3.0 - Estado actual con limitaciones documentadas*  

---

### üéâ Resumen Ejecutivo - ESTADO ACTUAL v1.3.0

El **Chatbot UTS v1.3.0** es un sistema integral de asistencia virtual para la comunidad universitaria, que combina:

‚úÖ **Inteligencia Artificial contextual** para respuestas naturales y apropiadas  
‚úÖ **Automatizaci√≥n robusta** de mantenimiento de contenido con detecci√≥n de cambios  
‚úÖ **Interfaces m√∫ltiples** adaptadas a cada tipo de usuario con temas personalizados  
‚úÖ **Arquitectura escalable** con soporte para crecimiento y nuevas funcionalidades  
‚úÖ **Monitoreo integral** con m√©tricas, feedback continuo y logging estructurado  
‚úÖ **Manejo inteligente de limitaciones** - respuestas apropiadas cuando datos no disponibles  
‚úÖ **Sistema preparado para el futuro** - reactivaci√≥n autom√°tica si UTS restaura informaci√≥n faltante  
‚úÖ **Mantenimiento aut√≥nomo** con actualizaciones inteligentes solo cuando es necesario  

### üéØ Diferencial Clave v1.3.0
- **Robustez ante cambios externos**: El sistema se adapta din√°micamente cuando fuentes de informaci√≥n no est√°n disponibles
- **Experiencia de usuario consistente**: Respuestas √∫tiles incluso cuando no tiene todos los datos
- **Inteligencia adaptativa**: Detecta el tipo de consulta y responde apropiadamente seg√∫n disponibilidad de datos
- **Preparaci√≥n para reactivaci√≥n**: Todos los componentes listos para funcionar si las fuentes se restauran

### ‚ö†Ô∏è Limitaci√≥n Actual Documentada
**Informaci√≥n de Docentes**: UTS elimin√≥ la secci√≥n de profesores del sitio oficial. El sistema detecta estas b√∫squedas y responde de forma √∫til ofreciendo alternativas de contacto.

El sistema est√° dise√±ado para **funcionar de manera aut√≥noma y resiliente**, manteni√©ndose actualizado autom√°ticamente con el contenido disponible de la UTS, adapt√°ndose a cambios en las fuentes oficiales, y proporcionando asistencia 24/7 √∫til y honesta a estudiantes, docentes y aspirantes.

---

**üè´ Proyecto desarrollado para la Universidad Tecnol√≥gica de Santander**  
**üë®‚Äçüíª Mario Andr√©s J√°come Mantilla - Ingenier√≠a de Sistemas**
